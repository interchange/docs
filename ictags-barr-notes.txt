Date: Wed, 11 Oct 2000 08:10:02 -0400
From: Mike Heins <mikeh@minivend.com>
Reply-To: mike@minivend.com
To: alison@akopia.com, tech@akopia.com
Subject: Re: Tag reference issues...

Quoting Jeff Barr Akopia" (barr@akopia.com):
> Hi Alison,
> 
> I did a bunch of reviewing of the tag lists found 
> in various places. Here is some info. Let's get
> what we can in for 4.6 and the rest we can get
> the next time. I've written these myself. Mike,
> can you verify for me?
> 
> 1. Try and Catch Tags
>    [try] ... [/try]
>    [catch] ... [/catch]
>    These four tags are used together. The tags within
>    the [try] block are executed. If all of the code
>    within the block executes without error then the
>    output produced by the tags is passed through to
>    the output. Otherwise, this output is discarded
>    and the output produced by the tags within the
>    [catch] block is inserted into the output. If
>    the code within the [try] block has side effects
>    then these effects must be explicitly reversed 
>    by the catch block if the operation fails.
> 

This looks good. Another key thing is that this will avoid any 500 server
error if code does a die().

> 2. "-" / "_" in tag names. Let's standardize on
>    "-" and note that "_" is a worthy alternative.
>    (Fixing this everywhere is too big of a job
>    for this release).

Also, note that when using tags in embedded Perl the underscore is
required, i.e. $Tag->total-cost could not work. Any real Perl programmer
would know that, but some of our users may not.

> 
> 3. Discount-subtotal Tag
>   [discount-subtotal]
> 
>   Expands into the discounted subtotal cost, exclusive of sales tax,
>   of all the items ordered so far.

This is the subtotal for the current line of the shopping cart, not
the order as a whole. The [subtotal] tag always reflects discounts.

Actually, this is probably an inconsistency that could be corrected
some time. IT really should be PREFIX-discount-subtotal. We would have
to deprecate, though, as there are plenty of implementations which
use this. 4.7 stuff.

>  
> 4. Some deprecated tags (we may want to have a list of these in one
>    place):
> 
>   - [region] is deprecated; [search-region] is preferred.

Yes. No mention need be made of it in the docs.

>   - [on_match] is deprecated.

No. This should really be made PREFIX-on-match or on-PREFIX-match,
as above, but it is not deprecated.


>   - [search] is deprecated.

Search is not deprecated, but is completely removed.

>   - [sql] is deprecated.

Yes. No mention need be made of it in the docs.

> 
> 5. Expected documentation - According to Mike you should have info on
>    the following tags:
> 
>    [scratchd]
>    [seti]
>    [tmp]

Should have come in the redline comments.

> 
> 6. [tag time] should be changed to [time].

Yes, but we need to document the options.

> 
> 7. Fly_tax Tag
> 
>    [fly_tax]
> 
>    (Mike -- need some help here. What does this tag do. The code
>     is impenetrable.)

It builds a tax rate from TAXAREA, TAXRATE, TAXSHIPPING, variable values and
the SalesTax directive value. I didn't document it because I was hoping to get
rid of it before MV4.0 release. Obviously that didn't happen. There is action
at a distance as well -- the tag is really called in salestax.asc. It is kind
of a mess, and I would hope that we fix this for 4.7.

> 
> 8. Log Tag
> 
>    This tag is documented as [tag log]; it should be changed to [log].

Yes. The options should be the same, but it needs to be checked.

> 
> 9. Filter Tag
> 
>    Longer-term, we need to have a complete document which describes
>    the [filter] model. Can you put this on your list of things to do.
> 
> 10. Handling Tag
> 
>    [handling]
> 
>    Calculates handling costs.

Yes, those shipmodes defined in mv_handling.

> 
> 11. Counter and FCounter
> 
>    [counter file=FILE start=START value=VALUE decrement*]
> 
>    Inserts the value of a persistent counter. The counter value is
>    stored in the given file, which is created if necessary. If the
>    file name begins with a "/" then it is an absolute path, otherwise
>    it is relative to VendRoot. If the tag causes the counter file to
>    be created then the value is initialized to start. If value is
>    given then the counter's value is set to the given value. If value
>    is not supplied then the counter is incremented and its value
>    returned, unless decrement is supplied, in which case the counter
>    is decremented and its value is returned. The counter is
>    implemented using Perl's File::Counter module which protects the
>    file against simultaneous access by multiple processes.
> 
>    [fcounter file=FILE start=START]
> 
>    Fcounter is a simpler version of [counter], implemented as a
>    UserTag on top of Perl's File::Counter module.
> 

Yes. We don't need to document fcounter, it is no longer in any of the
demos.

> 12. The export tag.
> 
>    This tag is documented as [tag export]; it should be changed to
>    [export].
> 

Yes. Options are the same.

-- 
Akopia, Inc., 131 Willow Lane, Floor 2, Oxford, OH  45056
phone +1.513.523.7621 fax 7501 <heins@akopia.com>

Research is what I'm doing when I don't know what I'm doing.
-- Wernher Von Braun



Date: Mon, 9 Oct 2000 19:02:52 -0700
From: "Jeff Barr (Akopia)" <barr@akopia.com>
To: tech@akopia.com
Subject: Bringing Order to the Tag List

I've tried to rationalize the various sources of information about
tags. My three sources are:

1. The code, 4.5.7, as taken from CVS on the morning of October 9th. 
   Specifically the Interpolate.pm and Parse.pm files.

2. The tag list from Alison. There is a section titled "INTERCHANGE
   TAGS"; this was part of a document that Mike reviewed last
   week. This list is identical to that found in mvdocs.pod and
   may have originated there.

3. The Tag Reference on developer.akopia.com.

The goal is to end up with a consistent list of tags in all three
places. (Ultimately of course it would be good to drive all of
the lists from one place).

Here is what I found:

1. [try] and [catch] are in the tag reference but not the other
   places. 

2. Note that the "_" and "-" characters are interchangeable in a tag
   name as long as the same delimiter is used within a matching pair
   of tags. Nevertheless, the tag reference should consistently use
   one and note that the other is available. (This is a note that I
   will pass on to Alison for her information). 

3. [discount_subtotal] is not documented.

4. [PREFIX-calc] is not documented. 

5. [region] is now [search-region] ; [region] is still accepted. 

6. [on_match] is not documented.

7. [search] in on the Tag Reference but nowhere else.

8. [scratch] and [scratchd] are not documented.

9. [tmp] is not documented.

10. [seti] is not documented. It appears to be a synonym for [set].

11. [time] is in the Tag Reference but nowhere else.

12. [fly_tax] is on the Tag Reference but nowhere else.

13. [harness] is in the Tag Reference. It is apparently part of the test
    harness. Perhaps this should not be enabled in shipped code.

14. [log] is on the Tag Reference but nowhere else.

15. Mike scratched [onfly] out of the latest tag reference but it is
    still in the code. Is it deprecated?

16. [filter] is on the Tag Reference but nowhere else.

17. [handling] is on the Tag Reference but nowhere else.

18. [sql] is on the Tag Reference but nowhere else.

19. [counter] and [fcounter] are not documented.

20. [export] is on the Tag Reference but nowhere else.

Anything that anyone can add/subtract/clarify within here will
be greatly appreciated!

Thanks,

Jeff;
