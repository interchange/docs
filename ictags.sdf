!init OPT_LOOK="akopia"; OPT_STYLE="manual" 
# $Id: ictags.sdf,v 1.13 2001-03-29 02:40:35 bill Exp $
!define DOC_NAME "Interchange Tags Reference"
!define DOC_TYPE ""
!define DOC_CODE "ictags"
!define DOC_VERSION substr('$Revision: 1.13 $', 11, -2)
!define DOC_STATUS "Draft"
!define DOC_PROJECT "Interchange"
!define DOC_URL "http://developer.akopia.com/ic/dev/ictags.html"
!define DOC_OWNER "1996-2001 Red Hat, Inc. {{EMAIL:info@akopia.com}}"
!define SHOW_COMMENTS 0
!define EXAMPLE_SESSION "6CZ2whqo"
!define EXAMPLE_DOMAIN "www.here.com"
!define EXAMPLE_CATALOG "mycatalog"
!define EXAMPLE_VLINK "mycatalog"
!define EXAMPLE_SECURE_DOMAIN "secure.here.com"
!define EXAMPLE_SKU "os28044"
!define EXAMPLE_SIZE "15oz"
!define EXAMPLE_PRODUCT "Framing Hammer"
!build_title

H1:Interchange Tag Reference

Interchange functions are accessed via ITL, the Interchange Tag Language.
The pages in a catalog may be mostly HTML, but they will use ITL tags
to provide access to Interchange's functions. ITL is a superset of
MML, or Minivend Markup Language. Minivend was the predecessor to
Interchange.

These tags perform various display and modification operations for
the user session. There nearly 100 standard predefined tags, and
the C<UserTag> facility allows you to create tags fully as powerful
that perform your own functions.


H2: Tag Syntax

ITL tags are similar to HTML in syntax, in that they accept
parameters or attributes and that there are both I<standalone> and
I<container> tags.

We will call an attribute a I<parameter> if it may be called
positionally or if it must be included (see the
{{CMD[jump="#parameters"]parameter}} and
{{CMD[jump="#attributes"]attribute}} sections below).

A standalone tag has no ending element, e.g.:

E:    E<lbracket>{{C[jump="#value"]value name}}]

This tag will insert the user's name, providing they have given it
to you in a form. A container tag has both a beginning and an ending
element, as in:

!block example
    E<lbracket>{{C[jump="#if"]if}} value name]
    You have a name.  It is [C<value> name].
    E<lbracket>/if]
!endblock

We will usually call the ITL tags B<Interchange tags> or just B<tags>. 

H3: Standard Syntax

The most common syntax is to enclose the tag with its parameters and
attributes in C<[square brackets]>.  If the tag has an end tag, the tag and
its end tag will delimit contained body text:

!block example
  [B<tagname> I<parameters> I<attributes>]Contained Body Text[/tagname]
!endblock

!block note; label="Caveat -- macros: "
Some macros look like tags or end tags. For example,
E<lbracket>{{C[jump="#page"]/page}}E<rbracket> is a macro for
E<lt>/AE<gt>). This allows you to conveniently write
E<lbracket>{{C[jump="#page"]page}}E<nbspace>I<href>]Target[C</page>],
but 'Target' is not treated as contained body text.
!endblock

When using the [C<tagname> ...] syntax, there must be no whitespace
between the left bracket ('[') and the tagname.

If a tag name includes an underscore or dash, as in
{{CMD[jump="#item_list"]item_list}}, a dash is just as appropriate
(i.e. C<item-list>). The two forms are interchangeable, except that an
ending tag must match the tag (i.e., don't use
C<E<lbracket>item-list]E<nbspace>listE<nbspace>[/item_list]>).

H4: HTML-Comment

ITL also allows you to use 'E<lt>!--[' and ']--E<gt>' as
interchangeable alternatives to plain square brackets:
C<E<lbracket>tagname]> and C<E<lt>!--[tagname]--E<gt>> are
equivalent.

This allows you make your raw tags appear as comments to HTML browsers
or editors.  You might want to do this if your editor has trouble with
ITL tags when editing Interchange page templates, or alternatively, if
you want to use one .html file both as an Interchange template and as
a static page delivered directly by your web server, without
Interchange processing.

To properly HTML-comment contained body text, place your comment-style
brackets appropriately, for example:

E: E<lt>!--[tagname] Contained Body Text E<lbracket>/tagname]-->

Note that you must include whitespace between the HTML comment
delimiters and the square brackets if you wish to actually comment out
tag output in the browser.  For example, if
E<lbracket>{{C[jump="#value"]value}}E<nbspace>name] expands to 'Bill':

E: E<lt>!--[value name]-->  becomes  Bill
E: E<lt>!-- [value name] -->  becomes  <!-- Bill -->

H5: Technical notes

While '<!--[' and '[' are interchangeable, the Interchange parser
does not replace ']-->' with ']' unless it sees '<!--[' elsewhere in
the page.

See the {{CMD[jump="#Template Parsing Order"]Template Parsing Order}}
appendix if you are modifying the special administrative interface
pages and intend to use this syntax.


H3: HTML-Embedded

As an alternative syntax, you can usually embed an Interchange tag as
an attribute within an HTML tag.  This allows some HTML editors to
work more easily with Interchange templates (though you should
consider the above HTML-comment-style brackets first).  The following
is a basic example of HTML-Embedded syntax:

!block example
  <C<HTMLtag> MV="B<tagname> I<positional parameters>" C<other HTML attributes>>
!endblock

The following examples will each loop over any items in the shopping cart, displaying
their part number, description, and price, but only IF there are items
in the cart.

. HTML syntax:
!block example
    <TABLE MV="if items">
    <TR MV="{{CMD[jump="#item_list"]item-list}}">
    <TD> E<lbracket>item-code] </TD>
    <TD> E<lbracket>item-description] </TD>
    <TD> E<lbracket>item-price] </TD>
    </TR></TABLE>
!endblock

. Standard syntax:
!block example
    E<lbracket>if items]
    <TABLE>
    E<lbracket>{{CMD[jump="#item_list"]item-list}}]
    <TR>
    <TD> E<lbracket>item-code] </TD>
    <TD> E<lbracket>item-description] </TD>
    <TD> E<lbracket>item-price] </TD>
    </TR>
    E<lbracket>/item-list]</TABLE>
    [/if]
!endblock

!block note; label="Note -- Disabling HTML-embedded tags for performance: "

Avoid the HTML-embedded usage if you can.

The foundation catalog included with interchange disables parsing of
the HTML-embedded syntax.  This is for better performance, since it
saves the server from checking every HTML tag for interchange tag
calls.  This is done in the catalog by setting the pragma
{{C[jump="icconfig.html#Pragma"]no_html_parse}} in C<catalog.cfg>.
!endblock


H3: {{CMD[id="parameters"]Named vs. Positional Parameters}}

There are two styles of supplying parameters to a
tagE<nbspace>E<emdash> named and positional.

In the named style you supply a parameter/value pair just as most HTML
tags use:

E:    E<lbracket>{{CMD[jump="#value"]value}} name="foo"]

The same thing can be accomplished for the C<E<lbracket>{{CMD[jump="#value"]value}}]> tag with

E:    E<lbracket>value foo]

The parameter C<name> is the first positional parameter for the
C<E<lbracket>{{CMD[jump="#value"]value}}]> tag. Some people find
positional usage simpler for common tags, and Interchange interprets
them somewhat faster. If you wish to avoid ambiguity you can always
use named calling. 

In most cases, tags specified in the positional fashion will work
the same as named parameters. The only time you will need to modify them
is when there is some ambiguity as to which parameter is which (usually
due to whitespace), or when you need to use the output of a tag as the
parameter or attribute for another tag.

H4: Interpolating parameters

If you wish to use the value of a tag within a parameter of another
tag, you cannot use a positional call.  You must also double-quote the
argument containing the tag you wish to have expanded.  For example,
this will not work:

E:    E<lbracket>{{C[jump="#page"]page}} scan se=[{{C[jump="#scratch"]scratch}} somevarE<2]>

To get the output of the C<[scratch somevar]> interpreted, you must
place it within a named and quoted attribute:

E:    E<lbracket>{{C[jump="#page"]page}} href=scan arg="se=[{{C[jump="#scratch"]scratch}} somevar]"]

Note that the argument to B<href> ('scan') did not need to be quoted;
only the argument to B<arg>, which contained a tag, needed the quotes.

H3: {{CMD[id="attributes"]Universal Attributes}}

Universal attributes apply to all tags, though each tag specifies
its own default for the attribute.  The code implementing universal
attributes is external to the core routines that implement specific
tags.


H4: {{CMD[id="attr_interpolate"]interpolate}}

This attribute behaves differently depending on whether the tag is a
I<container> or I<standalone> tag. A container tag is one which has
an end tag, i.e. C<[tag] stuff [/tag]>. A standalone tag has no end
tag, as in
E<lbracket>{{CMD[jump="#area"]area}}E<nbspace>href=somepage]. (Note
that E<lbracket>{{CMD[jump="#page"]page}} ...] and
E<lbracket>{{CMD[jump="#order"]order}} ..] are B<not> container tags.)

I<For container tags (interpolated)>
* If true ("interpolate=1"), the interchange server will first process
any tags within the body text before passing it to the enclosing tag.
* If false ("interpolate=0"), the enclosing tag will receive the raw
body text.

I<For standalone tags (reparsed)>
* If true, the server will process the I<output> of the tag.  This is
identical to the behavior of the {{CMD[jump="#attr_reparse"]reparse}} attribute (see below for
explanation and examples).

(Note: The mixing of 'interpolate' and 'reparse' logic occurred
because 'interpolate' already worked this way when 'reparse' was added
to interchange.  This may be fixed in a later release...)

Most standalone tags are not reparsed by default (i.e., interpolate=0
by default).  There are some exceptions, such as the
E<lbracket>{{CMD[jump="#include"]include}}] tag.

N: Interpolation example:

Assuming that C<name> is 'Kilroy',

!block example
   E<lbracket>{{C[jump="#log"]log}} interpolate=1][{{C[jump="#value"]value}}C< name>] was here[/log]
   E<lbracket>{{C[jump="#log"]log}} interpolate=0][{{C[jump="#value"]value}}C< name>] was here[/log]
!endblock   

the first line logs 'Kilroy was here' to I<catalog_root>/etc/log,
while the second logs '[valueE<nbspace>name] was here'.

N: Reparsing example:

Suppose we set a scratch variable called 'now' as follows: 

!block example
   E<lbracket>{{C[jump="#set"]set}} name=now interpolate=0][{{C[jump="#time"]time}}]%A, %B %d, %Y[/time][/set]
!endblock

If today is Monday, January 1, 2001, 

!block example
   E<lbracket>{{C[jump="#scratch"]scratch}} name=now interpolate=0]
   E<lbracket>{{C[jump="#scratch"]scratch}} name=now interpolate=1]
!endblock

the first line yields
E:   E<lbracket>{{C[jump="#time"]time}}]%A, %B %d, %Y[/time]

while the second yields
E:   Monday, January 1, 2001


H4: {{CMD[id="attr_reparse"]reparse}}

If true ("reparse=1"), the server will process any tags in the text
output by the reparsed tag.

Reparse applies only to container tags (those with an end tag).  The
C<interpolate> attribute controls reparsing of the output of
standalone tags (see above).

Most container tags will have their output re-parsed for more
Interchange tags by default. If you wish to inhibit this behavior, you
must explicitly set the attribute B<reparse> to 0.  Note that you will
almost always want the default action. The only container ITL tag that
doesn't have reparse set by default is
C<E<lbracket>{{CMD[jump="#mvasp"]mvasp}}]>. 

N: Example:

Assuming that C<name> is 'Kilroy',

!block example
  1.   E<lbracket>{{C[jump="#perl"]perl}} reparse=0]
          my $tagname = 'value';
          return "\[$tagname name\] was here\n"
       [/perl]

  2.   E<lbracket>{{C[jump="#perl"]perl}} reparse=1]
          my $tagname = 'value';
          return "\[$tagname name\] was here\n"
       [/perl]
!endblock   

expands to

!block example
  1.   E<lbracket>{{C[jump="#value"]value}}C< name>] was here

  2.   Kilroy was here
!endblock


H4: {{CMD[id="attr_send"]send}}

Depreciated


H3: Tag-specific Attributes

Each tag may accept additional named attributes which vary from tag to
tag.  Please see the entry for the tag in question for details about
tag-specific attributes.


H3: {{CMD[id="attr_array_hash"]Attribute Arrays and Hashes}}

Some tags allow you to pass an array or hash as the value of an
attribute.  For an ordinary tag, the syntax is as follows:

!block example
    attribute.I<n>=value

    attribute.hashkey=value
!endblock

where I<n> is an integer array index.  Note that you cannot use both an
array and a hash with the same attributeE<nbspace>E<emdash> if you use
B<attribute.I<n>>, you cannot also use B<attribute.key> for the same
attribute.

Here is an example of an attribute array:

!block example
    search.0="se=hammer
              fi=products
              sf=description"
    search.1="se=plutonium
              fi=products
              sf=comment"
!endblock

The E<lbracket>{{C[jump="#page"]page}}] tag, for example, treats a search
specification array as a joined search, automatically adding the other
relevant search fields, including the 'co=yes' to indicate a combined
search ({{CMD[jump="icdatabase.html#Coordinated and Joined Searching"]joined searches}}
are described in the Interchange database documentation).

Note that it is up to the tag to handle an array or hash value
properly.  See the documentation for the specific tag before passing
it an attribute array or hash value.

H4: Perl calls

Before passing attributes to a tag, the interchange parser would
convert the above example to an anonymous array reference.  It would
use the resulting arrayref as the value for the 'search' attribute in
this example.

If you were passing the above example directly to a tag routine
within a E<lbracket>{{C[jump="#perl"]perl}}] block or a
{{C[jump="#User-defined Tags"]usertag}}, you must actually pass an
anonymous array as the value of the attribute as N<follows:>

!block example
    my $arrayref = [ "se=hammer/fi=products/sf=description",
                     "se=plutonium/fi=products/sf=description", ];

    $Tag->I<routine>( { search => $arrayref, } );
!endblock

Similarly to use a hash reference for the 'entry' attribute:

!block example
    my $hashref = { name   => "required",
                    date   => 'default="%B %d, %Y"', };

    $Tag->I<routine>( { entry => $hashref } );
!endblock



H2: Looping tags and Sub-tags

{{CMD[id="subtags"]}}
Certain tags are not standalone; these are the
ones that are interpreted as part of a surrounding looping tag
like E<lbracket>{{C[jump="#loop"]loop}}],
E<lbracket>{{C[jump="#item_list"]item-list}}],
E<lbracket>{{C[jump="#query"]query}}], or
E<lbracket>{{C[jump="#region"]region}}].

. E<lbracket>{{C[jump="#sub_PREFIX-accessories"]PREFIX-accessories}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-alternate"]PREFIX-alternate}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-calc"]PREFIX-calc}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-change"]PREFIX-change}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-change"]PREFIX-change}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-code"]PREFIX-code}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-data"]PREFIX-data}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-description"]PREFIX-description}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-discount"]PREFIX-discount}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-field"]PREFIX-field}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-increment"]PREFIX-increment}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-last"]PREFIX-last}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-match"]PREFIX-match}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-modifier"]PREFIX-modifier}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-next"]PREFIX-next}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-param"]PREFIX-param}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-price"]PREFIX-price}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-quantity"]PREFIX-quantity}}E<rbracket>
. E<lbracket>{{C[jump="#sub_PREFIX-subtotal"]PREFIX-subtotal}}E<rbracket>
. E<lbracket>{{C[jump="#sub_if-PREFIX-data"]if-PREFIX-data}}E<rbracket>
. E<lbracket>{{C[jump="#sub_if-PREFIX-field"]if-PREFIX-field}}E<rbracket>
. E<lbracket>{{C[jump="#sub_modifier-name"]modifier-name}}E<rbracket>
. E<lbracket>{{C[jump="#sub_quantity-name"]quantity-name}}E<rbracket>

PREFIX represents the prefix that is used in that looping tag.
They are only interpreted within their container and only accept
positional parameters. The default prefixes:

!block table
Tag|Prefix|Examples
E<lbracket>{{CMD[jump="#loop"]loop}}]|loop|E<lbracket>loop-code], [loop-field price], [loop-increment]
E<lbracket>{{CMD[jump="#item_list"]item-list}}]|item|E<lbracket>item-code], [item-field price], [item-increment]
E<lbracket>{{C[jump="#search_list"]search-list}}]|item|E<lbracket>item-code], [item-field price], [item-increment]
E<lbracket>{{CMD[jump="#query"]query}}]|sql|E<lbracket>sql-code], [sql-field price], [sql-increment]
!endblock

Sub-tag behavior is consistent among the looping tags. 

There are two types of looping lists; ARRAY and HASH.

An array list is the normal output of a E<lbracket>{{C[jump="#query"]query}}E<rbracket>, a search, or a E<lbracket>{{C[jump="#loop"]loop}}E<rbracket>
tag. It returns from 1 to N C<return fields>, defined in the C<mv_return_fields>
or C<rf> variable or implicitly by means of a SQL field list. The two 
queries below are essentially identical:

>    [query sql="select foo, bar from products"]
>    [/query]
>
>    [loop search="
>                    ra=yes
>                    fi=products
>                    rf=foo,bar
>    "]

Both will return an array of arrays consisting of the C<foo> column and
the C<bar> column. The Perl data structure would look like:

>    [
>        ['foo0', 'bar0'],
>        ['foo1', 'bar1'],
>        ['foo2', 'bar2'],
>        ['fooN', 'barN'],
>    ]

A hash list is the normal output of the [item-list] tag. It returns
the value of all return fields in an array of hashes. A normal [item-list]
return might look like:

>    [
>        {
>            code     => '99-102',
>            quantity => 1,
>            size     => 'XL',
>            color    => 'blue',
>            mv_ib    => 'products',
>        },
>        {
>            code     => '00-341',
>            quantity => 2,
>            size     => undef,
>            color    => undef,
>            mv_ib    => 'products',
>        },
>
>    ]

You can also return hash lists in queries:

>    [query sql="select foo, bar from products" type=hashref]
>    [/query]

Now the data structure will look like:

>    [
>        { foo => 'foo0', bar => 'bar0' },
>        { foo => 'foo1', bar => 'bar1' },
>        { foo => 'foo2', bar => 'bar2' },
>        { foo => 'fooN', bar => 'barN' },
>    ]


H3: E<lbracket>{{CMD[id="sub_PREFIX-accessories"]PREFIX-accessories}} arglist]

The same as the [accessories ...] tag except always supplied the current item
code. If the list is a hash list, i.e. an [item-list], then the value of
the current item hash is passed so that a value default can be established.

H3: E<lbracket>{{CMD[id="sub_PREFIX-alternate"]PREFIX-alternate}} N] DIVISIBLE [else] NOT DIVISIBLE [/else][/PREFIX-alternate]

Set up an alternation sequence. If the item-increment is divisible by
`N', the text will be displayed. If an `[else]NOT DIVISIBLE TEXT[/else]'
is present, then the NOT DIVISIBLE TEXT will be displayed.
    
For example:

>    [item-alternate 2]EVEN[else]ODD[/else][/item-alternate]
>    [item-alternate 3]BY 3[else]NOT by 3[/else][/item-alternate]

H3: E<lbracket>{{CMD[id="sub_PREFIX-calc"]PREFIX-calc}}] 2 + [item-field price] [/PREFIX-calc]

Calls perl via the equivalent of the [calc] [/calc] tag pair. Much
faster to execute.

H3: E<lbracket>{{CMD[id="sub_PREFIX-change"]PREFIX-change}}][conditoon] ... [/condition] TEXT [/PREFIX-change]

Sets up a breaking sequence that occurs when the contents of 
\[condition] [/condition] change. The most common one is a category
break to nest or place headers.

The region is only output when a field or other repeating value between
\[condition] and [/condition] changes its value. This allows indented lists
similar to database reports to be easily formatted.  The repeating value
must be a tag interpolated in the search process, such as
C<[PREFIX-field field]> or C<[PREFIX-data database field]>. If you need
access to ITL tags, you can use [PREFIX-calc] with a $Tag->foo() 
call.

Of course, this will only work as you expect when the search results
are properly sorted.

The value to be tested is contained within a
C<[condition]value[/condition]> tag pair. The C<[PREFIX-change]> tag
also processes an C<[else] [/else]> pair for output when the value does
not change.

Here is a simple example for a search list that has a field C<category> and
C<subcategory> associated with each item:

> <TABLE>
> <TR><TH>Category</TH><TH>Subcategory</TH><TH>Product</TH></TR>
> [search-list]
> <TR>
>    <TD>
>         [item-change cat]
>
>         [condition][item-field category][/condition]
>
>                 [item-field category]
>         [else]
>                 &nbsp;
>         [/else]
>         [/item-change cat]
>    </TD>
>    <TD>
>         [item-change sub]
>
>         [condition][item-field subcategory][/condition]
>
>                 [item-field subcategory]
>         [else]
>                 &nbsp;
>         [/else]
>         [/item-change sub]
>    </TD>
>    <TD> [item-field name] </TD>
> [/search-list]
> </TABLE>

The above should put out a table that only shows the category and
subcategory once, while showing the name for every product. (The C<&nbsp;>
will prevent blanked table cells if you use a border.)

H3: E<lbracket>{{CMD[id="sub_PREFIX-code"]PREFIX-code}}]

The key or code of the current loop. In an [item-list] this is always
the product code; in a loop list it is the value of the current argument;
in a search it is whatever you have defined as the first mv_return_field (rf).

H3: E<lbracket>{{CMD[id="sub_PREFIX-data"]PREFIX-data}} table field]

Calls the column C<field> in database table C<table> for the current
\[PREFIX-code]. This may or may not be equivalent to C<[PREFIX-field field]>
depending on whether your search table is defined as one of the C<ProductFiles>.

H3: E<lbracket>{{CMD[id="sub_PREFIX-description"]PREFIX-description}}]

The description of the current item, as defined in the C<catalog.cfg> directive
C<DescriptionField>. In the demo, it would be the value of the field C<description>
in the table C<products>.

If the list is a hash list, and the lookup of C<DescriptionField> fails,
then the attribute C<description> will be substituted. This is useful to 
supply shopping cart descriptions for on-the-fly items.

H3: E<lbracket>{{CMD[id="sub_PREFIX-discount"]PREFIX-discount}}]

The price of the current item is calculated, and the difference between
that price and the list price (quantity one) price is output. This may have
different behavior than you expect if you set the [discount] [/discount]
tag along with quantity pricing.

H3: E<lbracket>{{CMD[id="sub_PREFIX-field"]PREFIX-field}}]

Looks up a field value for the current item in one of several places,
in this order:

>    1. The first ProductFiles entry.
>    2. Additional ProductFiles in the order they occur.
>    3. The attribute value for the item in a hash list.
>    4. Blank

A common user error is to do this:

>    [loop search="
>                    fi=foo
>                    se=bar
>                "]
>
>    [loop-field foo_field]
>    [/loop]

In this case, you are searching the table C<foo> for a string
of C<bar>. When it is found, you wish to display the value of C<foo_field>.
Unless C<foo> is in C<ProductFiles> and the code is not present in a previous
product file, you will get a blank or some value you don't want. What
you really want is C<[loop-data foo foo_field]>, which specifically 
addresses the table C<foo>.

H3: E<lbracket>{{CMD[id="sub_PREFIX-increment"]PREFIX-increment}}]

The current count on the list, starting from either 1 in a zero-anchored
list like E<lbracket>{{C[jump="#loop"]loop}}E<rbracket> or E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket>, or from the match count in a
search list.

If you skip items with [PREFIX-last] or [PREFIX-next], the count is NOT
adjusted.

H3: E<lbracket>{{CMD[id="sub_PREFIX-last"]PREFIX-last}}] CONDITION [/PREFIX-last]

If CONDITION evaluates true (a non-whitespace value that is not specifically
zero) then this will be the last item displayed.

H3: E<lbracket>{{CMD[id="sub_PREFIX-modifier"]PREFIX-modifier}} attribute]

If the item is a hash list (i.e. [item-list]), this will return the value
of the C<attribute>.

H3: E<lbracket>{{CMD[id="sub_PREFIX-next"]PREFIX-next}}] CONDITION [/PREFIX-next]

If CONDITION evaluates true (a non-whitespace value that is not specifically
zero) then this item is skipped.

H3: E<lbracket>{{CMD[id="sub_PREFIX-param"]PREFIX-param}} name]

H3: E<lbracket>{{CMD[id="sub_PREFIX-param"]PREFIX-param}} N]

Returns the array parameter associated with the looping tag row. Each
looping list returns an array of C<return fields>, set in searches with
C<mv_return_field> or C<rf>. The default is only to return the code of
the search result, but by setting those parameters you can return more
than one item.

In a [query ...] ITL tag you can select multiple return fields with
something like:

>    [query prefix=prefix sql="select foo, bar from baz where foo=buz"]
>        [prefix-code]  [prefix-param foo]  [prefix-param bar]
>    [/query]

In this case, [prefix-code] and [prefix-param foo] are synonymns, for
C<foo> is the first returned parameter and becomes the code for this row.
Another synonym is [prefix-param 0]; and [prefix-param 1] is the same
as [prefix-param bar].

H3: E<lbracket>{{CMD[id="sub_PREFIX-price"]PREFIX-price}}]

The price of the current code, formatted for currency. If
Interchange's pricing routines cannot determine the price (i.e. it is not
a valid product or on-the-fly item) then zero is returned. If the list
is a hash list, the price will be modified by its C<quantity> or other
applicable attributes (like C<size> in the demo).

H3: E<lbracket>{{CMD[id="sub_PREFIX-quantity"]PREFIX-quantity}}]

The value of the C<quantity> attribute in a hash list. Most commonly
used to display the quantity of an item in a shopping cart [item-list].

H3: E<lbracket>{{CMD[id="sub_PREFIX-subtotal"]PREFIX-subtotal}}]

The [PREFIX-quantity] times the [PREFIX-price]. This does take discounts
into effect.

H3: E<lbracket>{{CMD[id="sub_if-PREFIX-data"]if-PREFIX-data}} table field] IF text [else] ELSE text [/else] [/if-PREFIX-data]

Examines the data field, i.e. [PREFIX-data table field], and if it is
non-blank and non-zero then the C<IF text> will be returned. If it is false,
i.e. blank or zero, the C<ELSE text> will be returned to the page.

This is much more efficient than the otherwise equivalent
C<[if type=data term=table::field::[PREFIX-code]]>.

You cannot place a condition; i.e. [if-PREFIX-data table field eq 'something'].
Use C<[if type=data ...]> for that.

Careful, a space is not a false value!

H3: E<lbracket>{{CMD[id="sub_if-PREFIX-field"]if-PREFIX-field}} field] IF text [else] ELSE text [/else] [/if-PREFIX-field]

Same as [if-PREFIX-data ...] except uses the same data rules as C<[PREFIX-field]>.

H3: E<lbracket>{{CMD[id="sub_modifier-name"]modifier-name}} attribute]

Outputs a variable name which will set an appropriate variable name for setting
the attribute in a form (usually a shopping cart). Outputs for successive items
in the list:

>    1. attribute0
>    2. attribute1
>    3. attribute2

etc.

H3: E<lbracket>{{CMD[id="sub_quantity-name"]quantity-name}}]

Outputs for successive items in the list:

>    1. quantity0
>    2. quantity1
>    3. quantity2

etc. C<[modifier-name quantity]> would be the same as C<[quantity-name]>.


H1: Tags

Each ITL tag is show below. Calling information is defined for the main tag,
sub-tags are described in C<Sub-tags>.


H2: accessories

Allows access to Interchange's product option attributes (e.g., to
choose or access product options such as a shirt's size or color).

Can build selection objects (radio, check, select boxes, etc) or
forms, or can simply return a value.

Or more-- see also {{CMD[jump="#Item_Attributes"]Item_Attributes}} and
{{CMD[jump="#subtags"]Looping tags and Sub-tags}}.


H3: Summary

!block example;
    [B<accessories> code arg I<other named attributes>]
    [B<accessories> code=[[EXAMPLE_SKU]] arg=color I<other named attributes>]
!endblock

!block table; colvaligns="TTT"
Parameters|Description|Default
{{CMD[jump="#accessories_code"]code}}|<<
Value of the master key in the product (or specified other) table
>>|I<none>
{{CMD[jump="#accessories_arg"]arg}}|<<
Positionally interpreted comma-delimited list of values for the
following N<attributes:>
. "attribute, type, column, table, name, outboard, passed"
. {{}}
* These may also be set individually as separate named attributes
* See {{CMD[jump="#Item_Attributes"]Item Attributes}} for detail
>>|I<none>
!endblock

!block table; colvaligns="TT"
Attributes|Default
{{CMD[jump="#accessories_attribute"]attribute}}|I<none>
{{CMD[jump="#accessories_type"]type}}|select
{{CMD[jump="#accessories_column"]column}}|I<none>
{{CMD[jump="#accessories_table"]table}}|products
{{CMD[jump="#accessories_name"]name}}|I<none>
{{CMD[jump="#accessories_outboard"]outboard}}|I<none>
{{CMD[jump="#accessories_passed"]passed}}|I<none>
key (alias for C<code>)|I<see code parameter above>
row (alias for C<code>)|I<see code parameter above>
{{CMD[jump="#accessories_table"]base}} (alias for C<table>)|I<see table>
{{CMD[jump="#accessories_table"]database}} (alias for C<table>)|I<see table>
{{CMD[jump="#accessories_table"]db}} (alias for C<table>)|I<see table>
{{CMD[jump="#accessories_column"]col (alias for C<column>}}|I<see column>
{{CMD[jump="#accessories_column"]field}} (alias for C<column>}}|I<see column>
{{CMD[jump="#accessories_prepend"]prepend}}|I<none>
{{CMD[jump="#accessories_append"]append}}|I<none>
{{CMD[jump="#accessories_delimiter"]delimiter}}|I<none>
{{CMD[jump="#accessories_item"]item}}|I<none>
{{CMD[jump="#accessories_extra"]extra}}|I<none>
{{CMD[jump="#accessories_js"]js}}|I<none>
{{CMD[jump="#accessories_rows"]rows}}|I<none>
{{CMD[jump="#accessories_cols"]cols}}|I<none>
{{CMD[jump="#accessories_width"]width}}|I<none>
{{CMD[jump="#accessories_default"]default}}|I<none>
{{CMD[jump="#accessories_price"]price}}|I<none>
{{CMD[jump="#accessories_contains"]contains}} (C<type> = radio or checkbox)|I<none>
{{CMD[jump="#accessories_joiner"]joiner}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_href"]href}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_template"]template}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_selected_begin"]selected_begin}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_form"]form}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_empty"]empty}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_secure"]secure}} (C<type> = hyperlink)|I<none>
{{CMD[jump="#accessories_new"]new}} (C<type> = combo or reverse_combo)|I<none>
{{CMD[jump="#attr_interpolate"]interpolate (reparse)}}|I<No>
!endblock

!block table; headings=1; colvaligns="TT"
A|B
Other_Charactreristics|
Invalidates cache|I<No>
Has Subtags|I<No>
Container tag|I<No>
!endblock

B<Tag expansion example:>

E:    E<lbracket>accessories [[EXAMPLE_SKU]] color]

This will search the product database for a field named "color". If
an entry "beige=Almond, gold=Harvest Gold, White*, green=Avocado" is found,
a select box like this will be built:

!block example
    <SELECT NAME="mv_order_color">
    <OPTION VALUE="beige">Almond
    <OPTION VALUE="gold">Harvest Gold
    <OPTION SELECTED>White
    <OPTION VALUE="green">Avocado
    </SELECT>
!endblock


B<ASP-like Perl call:>

!block example; lang='Perl'
    $Tag->accessories(  { code   => '[[EXAMPLE_SKU]]',
                          arg    => 'color, radio,'
                          table  => 'special_products', }  );
!endblock

or similarly with positional parameters,

!block example; lang='Perl'
    $Tag->accessories($code, $arg, $attribute_hash_reference);
!endblock

H4: See Also

{{CMD[jump="#Item_Attributes"]Item Attributes}} and
{{CMD[jump="#subtags"]Looping tags and Sub-tags}}.


H3: Description


Allows access to Interchange's product option attributes (e.g., to
choose or access product options such as a shirt's size or color).

If passed any of the optional arguments, initiates special processing
of item attributes based on entries in the product database.

Interchange allows item attributes to be set for each ordered item. This
allows a size, color, or other modifier to be attached to a line
item in the shopping cart. Previous attribute values can be resubmitted
by means of a hidden field on a form.

The C<catalog.cfg> file directive I<UseModifier> is used to set
the name of the modifier or modifiers. For example

>    UseModifier        size color

will attach both a size and color attribute to each item code that
is ordered.

B<IMPORTANT NOTE:> You may not use the following names for attributes:

>    item  group  quantity  code  mv_ib  mv_mi  mv_si

You can also set it in scratch with the mv_UseModifier
scratch variableE<nbspace>E<emdash> C<[set mv_UseModifier]size color[/set]> has the
same effect as above. This allows multiple options to be set for
products. Whichever one is in effect at order time will be used.
Be careful, you cannot set it more than once on the same page.
Setting the C<mv_separate_items> or global directive I<SeparateItems>
places each ordered item on a separate line, simplifying attribute
handling. The scratch setting for C<mv_separate_items> has the same
effect.

The modifier value is accessed in the E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket> loop with the
C<[item-param attribute]> tag, and form input fields are placed with the
C<[modifier-name attribute]> tag. This is similar to the way that quantity
is handled.

\NOTE: You must be sure that no fields in your forms have digits appended to
their names if the variable is the same name as the attribute name you
select, as the C<[modifier-name size]> variables will be placed in the
user session as the form variables size0, size1, size2, etc.

Interchange will automatically generate the select boxes
when the C<[accessories <code> size]> or C<[item-accessories size]>
tags are called. They have the syntax:

>   [item_accessories attribute, type*, column*, table*, name*, outboard*]
>
>   [accessories code=sku
>                attribute=modifier
>                type="select|radio|display|show|checkbox|text|textarea"*
>                column=column_name*
>                table=db_table*
>                name=varname
>                outboard=key
>                passed="value=label, value2, value3=label 3" ]

>	[accessories
>				js=| onChange="set_description(simple_options, variant)"; |
>				type=select
>				name="[item-param o_group]"
>				passed="=--choose--,[item-param o_value]"
>	]



H4: {{CMD[id="accessories_code"]code}}

This is the master key (usually SKU) of the specified table, or the
products table by default. The C<code> argument is implicit if looping
on E<lbracket>item_accessories]. 


H4:  {{CMD[id="accessories_arg"]arg}}

The optional C<arg> argument


H4: {{CMD[id="accessories_attribute"]attribute}}



H4: {{CMD[id="accessories_type"]type}}



H4: {{CMD[id="accessories_column"]column}}



H4: {{CMD[id="accessories_table"]table}}



H4: {{CMD[id="accessories_name"]name}}



H4: {{CMD[id="accessories_outboard"]outboard}}



H4: {{CMD[id="accessories_passed"]passed}}



H4: {{CMD[id="accessories_prepend"]prepend}}



H4: {{CMD[id="accessories_append"]append}}



H4: {{CMD[id="accessories_delimiter"]delimiter}}



H4: {{CMD[id="accessories_item"]item}}



H4: {{CMD[id="accessories_extra"]extra}}



H4: {{CMD[id="accessories_js"]js}}



H4: {{CMD[id="accessories_rows"]rows}}



H4: {{CMD[id="accessories_cols"]cols}}



H4: {{CMD[id="accessories_width"]width}}



H4: {{CMD[id="accessories_default"]default}}



H4: {{CMD[id="accessories_price"]price}}



H4: {{CMD[id="accessories_contains"]contains}} (C<type> = radio or checkbox)



H4: {{CMD[id="accessories_joiner"]joiner}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_href"]href}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_template"]template}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_selected_begin"]selected_begin}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_form"]form}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_empty"]empty}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_secure"]secure}} (C<type> = hyperlink)



H4: {{CMD[id="accessories_new"]new}} (C<type> = combo or reverse_combo)


H4: Examples

B<Tag expansion example:>

!block example
   [accessories code=[[EXAMPLE_SKU]] arg=color]

   TAGRESULT
!endblock

Positional call example:

>    [accessories code arg]

Named call example:

>    [accessories code=[[EXAMPLE_SKU]] arg=color]




H4: code

Not needed for item-accessories, this is the product code of the item to
reference.
 
H4: attribute

The item attribute as specified in the UseModifier configuration
directive. Typical are C<size> or C<color>.

H4: type

The action to be taken. One of:

!block table; colvaligns="TT"
Action|Description
select|<<
Builds a dropdown <SELECT> menu for the attribute. N<Note:> This is
the default.
>>
multiple|<<
Builds a multiple dropdown <SELECT> menu for the
attribute.  The size is equal to the number of
option choices.
>>
display|<<
Shows the label text for *only the selected option*.
>>
show|<<
Shows the option choices (no labels) for the option.
>>
radio|<<
Builds a radio box group for the item, with spaces
separating the elements.
>>
radio nbsp|<<
Builds a radio box group for the item, with &nbsp;
separating the elements.
>>
radio left n|<<
Builds a radio box group for the item, inside a
table, with the checkbox on the left side. If "n"
is present and is a digit from 2 to 9, it will align
the options in that many columns.
>>
radio right n|<<
Builds a radio box group for the item, inside a
table, with the checkbox on the right side. If "n"
is present and is a digit from 2 to 9, it will align
the options in that many columns.
>>
check|<<
Builds a checkbox group for the item, with spaces
separating the elements.
>>
check nbsp|<<
Builds a checkbox group for the item, with &nbsp;
separating the elements.
>>
check left n|<<
Builds a checkbox group for the item, inside a
table, with the checkbox on the left side. If "n"
is present and is a digit from 2 to 9, it will align
the options in that many columns.
>>
check right n|<<
Builds a checkbox group for the item, inside a
table, with the checkbox on the right side. If "n"
is present and is a digit from 2 to 9, it will align
the options in that many columns.
>>
textarea_XX_YY|<<
A textarea with XX columns and YY rows
>>
text_XX|<<
A text box with XX size in characters
>>
combo|<<
Special type, used with nullselect filter,
for selecting from a list or inputting a
new value
>>
reverse_combo|<<
Special type, used with last_non_null filter,
for selecting from a list or inputting a
new valueE<nbspace>E<emdash> differs from combo in order of
presentation
>>
move_combo|<<
Special type, used with null_to_space or
null_to_comma filter, for selecting multiple non-ordered
values from a list or inputting into a textarea
>>
links|<<
Produces a series of links based on the option
values. The base form value is passed via the
form parameter, just like in an E<lbracket>area ...] or
E<lbracket>page ...] tag, and the value is named with
the passed NAME attribute.
>>
!endblock

The default is 'select', which builds an HTML select form entry for
the attribute.  Also recognized is 'multiple', which generates a
multiple-selection drop down list, 'show', which shows the list of
possible attributes, and 'display', which shows the label text for the
selected option only.

H4: column

The database column name to be used to build the entry (usually a field
in the products database).  Defaults to a field named the same as the
attribute.

H4: table

The database table to find B<column> in, defaults to the first products file
where the item code is found.

H4: name

Name of the form variable to use if a form is being built. Defaults to
mv_order_B<attribute>E<nbspace>E<emdash> i.e.  if the attribute is B<size>, the form
variable will be named B<mv_order_size>. If the variable is set in the
user session, the widget will "remember" its previous setting.

H4: outboard

If calling the item-accessories tag, and you wish to select from an
outboard database table with a different key from the item code, you
can pass the key to use to find the accessory data.

H4: passed

Options for the widget if set explicitly, i.e. overrides a databae
fetch of the attribute input string.

For example, to generate a select box with a blank option (perhaps
forcing a select), the value of C<blue> with a label of B<Blue>, and the
value of C<green> with a label of B<Sea Green>, do:

>        [accessories
>            type=select
>                name=color
>                passed="=--select--, blue=Blue, green=Sea Green"
>        ]

This will generate:

>        <SELECT NAME="color">
>        <OPTION VALUE="">--select--
>        <OPTION VALUE="blue">Blue
>        <OPTION VALUE="green">Sea Green
>        </SELECT>

H4: href

Base HREF for the link in a C<links> type. Default is the current
page.

H4: form

Base value for the form in a C<links> type. Default is C<mv_action=return>,
which will simply set the variable value in the link.

For example, to generate a series of links that set the variable "color"
to the same as the options described in the C<passed> attribute (blank, blue, or green),
do

>        [accessories
>            type=links
>                name=color
>                passed="=--select--, blue=Blue, green=Sea Green"
>        ]

This will generate:

>    <A HREF="VENDURL/MV_PAGE?mv_action=return&color=blue">Blue</A><BR>
>    <A HREF="VENDURL/MV_PAGE?mv_action=return&color=green">Sea Green</A>
>
>    where VENDURL is your Interchange URL for the catalog
>          MV_PAGE is the current page

If you want the empty "--select--" option to show up, pass an
empty=1 parameter.


When called with an attribute, the database is consulted and looks for
a comma-separated list of attribute options. They take the form:

>    name=Label Text, name=Label Text*

The label text is optionalE<nbspace>E<emdash> if none is given, the B<name> will
be used.

If an asterisk is the last character of the label text, the item is
the default selection. If no default is specified, the first will be
the default. An example:

>    [item_accessories color]

This will search the product database for a field named "color". If
an entry "beige=Almond, gold=Harvest Gold, White*, green=Avocado" is found,
a select box like this will be built:

>    <SELECT NAME="mv_order_color">
>    <OPTION VALUE="beige">Almond
>    <OPTION VALUE="gold">Harvest Gold
>    <OPTION SELECTED>White
>    <OPTION VALUE="green">Avocado
>    </SELECT>

In combination with the C<mv_order_item> and C<mv_order_quantity> variables
this can be used to allow entry of an attribute at time of order.

If used in an item list, and the user has changed the value, the generated
select box will automatically retain the current value the user has selected.

The value can then be displayed with C<[item-modifier size]> on the
order report, order receipt, or any other page containing an
E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket>. 


When called with an attribute, the database is consulted and looks for
a comma-separated list of attribute options. They take the form:

>    name=Label Text, name=Label Text*

The label text is optionalE<nbspace>E<emdash> if none is given, the B<name> will
be used.

If an asterisk is the last character of the label text, the item is
the default selection. If no default is specified, the first will be
the default. An example:

>    [accessories TK112 color]

This will search the product database for a field named "color". If
an entry "beige=Almond, gold=Harvest Gold, White*, green=Avocado" is found,
a select box like this will be built:

>    <SELECT NAME="mv_order_color">
>    <OPTION VALUE="beige">Almond
>    <OPTION VALUE="gold">Harvest Gold
>    <OPTION SELECTED>White
>    <OPTION VALUE="green">Avocado
>    </SELECT>

In combination with the I<mv_order_item> and I<mv_order_quantity> variables
this can be used to allow entry of an attribute at time of order.


H4: Emulating with a loop

Below is a fragment from a shopping basket display form which 
shows a selectable size with "sticky" setting and a price that
changes based upon the modifier setting. Note that this
would normally be contained within the E<lbracket>{{C[jump="#item_list"]item_list}}E<rbracket> C<[/item-list]>
pair.

>    <SELECT NAME="[modifier-name size]">
>    [loop option="[modifier-name size]" list="S, M, L, XL"]
>    <OPTION> [loop-code] -- [price code="[item-code]" size="[loop-code]"]
>    [/loop]
>    </SELECT>

The above is essentially the same as would be output with the
\[item-accessories size] tag if the product database field C<size>
contained the value C<S, M, L, XL>, but contains the adjusted price.






H2: and


H3: Summary

\Parameters: B<type term op compare>

THIS TAG HAS SPECIAL POSITIONAL PARAMETER HANDLING.



Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

Called Routine for positonal: 

B<ASP-like Perl call:>

>    $Tag->and(
>        {
>         type => VALUE,
>         term => VALUE,
>         op => VALUE,
>         compare => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->and($type, $term, $op, $compare);

Attribute aliases

>            base ==> type
>            comp ==> compare
>            operator ==> op


 

H3: Description

The [and ...] tag is only used in conjunction with [if ...]. Example:

>        [if value fname]
>        [and value lname]
>        Both first and last name are present.
>        [else]
>        Missing one of "fname" and "lname" from $Values.
>        [/else]
>        [/if]

See C<[if ...]>.




H2: area

N:Alias:  B<href>

Expands to the URL for an Interchange page or action,
including the Interchange session ID and supplied arguments.  This is
very similar to the {{CMD[jump="#page"]page}} tagE<nbspace>E<emdash> these are
equivalent:
>    [page href=dir/page arg=mv_arg]TargetName[/page]
>    <A HREF="[area href=dir/page arg=mv_arg]">TargetName</A>


H3: Summary

!block example;
    [B<area> href arg I<other named attributes>]
    [B<area> href=dir/page arg=page_arguments I<other named attributes>]
!endblock


#!block table; style="plain"; colvaligns="TTT"
!block table; colvaligns="TTT"
Parameters|Description|Default
href|<<
Path to Interchange page or action
. I<Special arguments>
** '{{C[jump="#area_search"]scan}}' links to a search (using search arguments in B<arg>)
** 'http://...' external link (requires B<form> attribute)
>>|process
arg|Interchange arguments to page or action|I<none>
!endblock

#!block table; style="plain"; colvaligns="TT"
!block table; colvaligns="TT"
Attributes|Default
{{CMD[jump="#area_form"]form}}|I<none>
{{CMD[jump="#area_search"]search}}|I<No>
{{CMD[jump="#area_secure"]secure}}|I<No>
{{CMD[jump="#attr_interpolate"]interpolate (reparse)}}|I<No>
!endblock

#!block table; style="plain"; headings=1; colvaligns="TT"
!block table; headings=1; colvaligns="TT"
A|B
Other_Charactreristics|
Invalidates cache|I<No>
Macro|I<No>
Has end tag|I<No>
!endblock

B<Tag expansion example:>

!block example
   [area href=dir/page.html arg="arg1=AA/arg2=BB"]

   [[EXAMPLE_DOMAIN]]/cgi-bin/[[EXAMPLE_CATALOG]]/page.html?mv_session_id=[[EXAMPLE_SESSION]]&\
   mv_pc=1&mv_arg=arg1%3dAA/arg2%3dBB
!endblock

B<ASP-like Perl call:>

!block example; lang='Perl'
    $Tag->area(  { href => "dir/page",
                   arg  => "arguments", }  );
!endblock

or similarly with positional parameters,

!block example; lang='Perl'
    $Tag->area($href, $arg, $attribute_hash_reference);
!endblock

H4: See Also

{{CMD[jump="#page"]page}}


H3: Description


The C<area> tag is very similar to the {{CMD[jump="#page"]page}}
tag.  It produces the URL to call an Interchange page, but it differs
from C<page> in that it does not supply the surrounding
E<lt>AE<nbspace>HREFE<nbspace>...E<gt> notation. This can be used to
get control of your HREF items, perhaps to place an ALT string or a
Javascript construct.

It was originally named C<area> because it also can be used in a
client-side image map.

The C<area> tag has an alias of C<href>. The two links below
are identical in operation:

>   <A HREF="[area href=catalog]" ALT="Main catalog page">Catalog Home</A>
>   <A HREF="[href href=catalog]" ALT="Main catalog page">Catalog Home</A>

The optional I<arg> is used just as in the {{CMD[jump="#page"]page}} tag.


H4: {{CMD[id="area_form"]form}}

The optional C<form> argument allows you to encode a form in the link.

!block example
   <A HREF="[area form="mv_order_item=[[EXAMPLE_SKU]]
                        mv_order_size=[[EXAMPLE_SIZE]]
                        mv_order_quantity=1
                        mv_separate_items=1
                        mv_todo=refresh"]"> Order [[EXAMPLE_SIZE]] [[EXAMPLE_PRODUCT]]</A>
!endblock

See the description of the {{CMD[jump="#page_form"]page}} tag for more
detail.


H4: {{CMD[id="area_search"]search}}

Interchange allows you to pass a search in a URL. There are two ways
to do this:

^ Place the search specification in the named C<search> attribute.

** Interchange will ignore the C<href> parameter (the link will be set
to 'scan'.

** If you give the C<arg> parameter a value, that value will be
available as E<lbracket>{{C[jump="#value"]value}} mv_arg] within the
search display page.

+ Set the C<href> parameter to 'scan' and set C<arg> to the search
specification.

** Note that you can use this form positionallyE<nbspace>E<emdash> the
values go into C<href> and C<arg>, so you do not have to name
parameters.

These are identical:

!block example
   <A HREF="[area scan
                  se=Impressionists
                  sf=category]">Impressionist Paintings</A>

   <A HREF="[area href=scan
                   arg="se=Impressionists
                        sf=category"]">Impressionist Paintings</A>

   <A HREF="[area search="se=Impressionists
                          sf=category"]">Impressionist Paintings</A>

!endblock

See the description of the {{CMD[jump="#page_search"]page}} tag for more
detail.


H4: Examples

B<Tag expansion example:>

!block example
   [area href=dir/page.html arg="arg1=AA/arg2=BB"]

   [[EXAMPLE_DOMAIN]]/cgi-bin/[[EXAMPLE_CATALOG]]/page.html?mv_session_id=[[EXAMPLE_SESSION]]&\
   mv_pc=1&mv_arg=arg1%3dAA/arg2%3dBB
!endblock

Positional call example:

>    <A HREF="[area ord/basket]">Check basket</A>

Named call example:

>    <A HREF="[area ord/basket]">Check basket</A>

HTML-embedded example (disabled if no_html_parse {{CMD[jump="#Pragma"]Pragma}} active):

>    <A MV="area dir/page" HREF="dir/page.html">



H2: attr_list


H3: Summary

\Parameters: B<hash>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [attr_list] FOO [/attr_list].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->attr_list(
>        {
>         hash => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->attr_list($hash, $BODY);

 

H3: Description

Tags an attribute list with values from a hash. Designed for use in
embedded Perl.

\Example:

>        [perl tables=products]
>                my %opt = (
>                        hashref => 1,
>                        sql => 'select * from  products',
>                );
>                my $ary_of_hash = $Db{products}->query(\%opt);
>                my $template = <<EOF;
>{sku} - {description} - {price|Call for price}
>        {image?}<IMG SRC="{image}">{/image?}
>        {image:}No image available{/image:}
>EOF
>                foreach my $ref (@$ary_of_hash) {
>                        $out .= $Tag->attr_list($template, $ref);
>                }
>                return $out;
>        [/perl]

Tags according to the following rules:


H4: E<lbrace>key}

Inserts the value of the key for the reference. In a database query, this
is the column name.

H4: E<lbrace>key|fallback string}

Displays the value of {key} or if it is zero or blank, the fallback string.

H4: E<lbrace>key true string}

Displays C<true string> if the value of {key} is non-blank, non-zero,
or displays nothing if the key is false.

H4: E<lbrace>key?} true text {/key?}

Displays C<true text> if the value of {key} is non-blank, non-zero, and nothing
otherwise.

H4: E<lbrace>key:} false text {/key:}

Displays C<false text> if the value of {key} is blank or zero, and nothing
otherwise.






H2: banner


H3: Summary

\Parameters: B<category>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->banner(
>        {
>         category => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->banner($category, $ATTRHASH);

 

H3: Description

The [banner ...] tag is designed to implement random or rotating
banner displays in your Interchange pages. See the main Interchange documentation,
section I<Banner/Ad rotation>.





H2: bounce


H3: Summary

\Parameters: B<href if>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->bounce(
>        {
>         href => VALUE,
>         if => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->bounce($href, $if);

 

H3: Description

The [bounce ...] tag is designed to send an HTTP redirect (302 status code)
to the browser and redirect it to another (possibly Interchange-parsed) page.

It will stop ITL code execution at that point; further tags will not
be run through the parser. Bear in mind that if you are inside a looping
list, that list will run to completion and the [bounce] tag will not
be seen until the loop is complete.

Example of bouncing to an Interchange parsed page:

>        [if !scratch real_user]
>        [bounce href="[area violation]"]
>        [/if]

Note the URL is produced by the C<[area ...]> ITL tag.

Since the HTTP says the URL needs to be absolute, this one might
cause a browser warning:

>        [if value go_home]
>        [bounce href="/"]
>        [/if]

But running something like one of the Interchange demos you can
do:

>        [if value go_home]
>        [bounce href="__SERVER_NAME__/"]
>        [/if]
>
>        [if value go_home]
>        [bounce href="/"]
>        [/if]





H2: calc


H3: Summary

No parameters.

Pass attribute hash as last to subroutine: B<no>

Interpolates B<container text> by default>.

This is a container tag, i.e. [calc] FOO [/calc].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->calc(
>        {
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->calc($BODY);

 

H3: Description


syntax: [calc] EXPRESSION [/calc]

Starts a region where the arguments are calculated according to normal
arithmetic symbols. For instance:

>    [calc] 2 + 2 [/calc]

will display:

>    4

The [calc] tag is really the same as the [perl] tag, except
that it doesn't accept arguments, interpolates surrounded Interchange
tags by default, and is slightly more efficient to parse.

\Tip: The [calc] tag will remember variable values inside one page, so
you can do the equivalent of a memory store and memory recall for a loop.

ASP Note: There is never a reason to use this tag in a [perl] or ASP section.





H2: cart


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->cart(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->cart($name);

 

H3: Description


Sets the name of the current shopping cart for display of shipping, price,
total, subtotal, shipping, and nitems tags. 





H2: catch


H3: Summary

\Parameters: B<label>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [catch] FOO [/catch].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->catch(
>        {
>         label => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->catch($label, $ATTRHASH, $BODY);

 

H3: Description

B<NO Description>




H2: cgi


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->cgi(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->cgi($name);

 

H3: Description

Displays the value of a CGI variable B<submitted to the current page>. This
is similar to C<[value ...]>, except it displays the transitory values that
are submitted with every request.

For instance, if you access the following URL:

>        http://VENDURL/pagename?foo=bar

C<bar> will be substituted for C<[cgi foo]>.

This is the same as $CGI->{foo} in embedded Perl.





H2: checked


H3: Summary

\Parameters: B<name value>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->checked(
>        {
>         name => VALUE,
>         value => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->checked($name, $value, $ATTRHASH);

 

H3: Description


You can provide a "memory" for drop-down menus, radio buttons, and
checkboxes with the [checked] and [selected] tags.

>    <INPUT TYPE=radio NAME=foo
>            VALUE=on [checked name=foo value=on default=1]>
>    <INPUT TYPE=radio NAME=foo
>            VALUE=off [checked name=foo value=off]>

This will output CHECKED if the variable C<var_name> is equal to
C<value>. Not case sensitive unless the optional C<case=1> parameter is used.

The C<default> parameter, if true (non-zero and non-blank), will cause
the box to be checked if the variable has never been defined.

Note that CHECKBOX items will never submit their value if not checked,
so the box will not be reset. You must do something like:

>    <INPUT TYPE=checkbox NAME=foo
>            VALUE=1 [checked name=foo value=1 default=1]>
>    [value name=foo set=""]

By default, the Values space (i.e. [value foo]) is checkedE<nbspace>E<emdash> if you
want to use the volatile CGI space (i.e. [cgi foo]) use the option
C<cgi=1>.





H2: control


H3: Summary

\Parameters: B<name default>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->control(
>        {
>         name => VALUE,
>         default => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->control($name, $default, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: control_set


H3: Summary

\Parameters: B<index>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [control_set] FOO [/control_set].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->control_set(
>        {
>         index => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->control_set($index, $ATTRHASH, $BODY);

 

H3: Description

B<NO Description>




H2: counter


H3: Summary

\Parameters: B<file>

Positional parameters in same order.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->counter(
>        {
>         file => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->counter($file, $ATTRHASH);

Attribute aliases

>            name ==> file

H3: Description

Manipulates a persistent counter, by default incrementing it and returning the new value.

The counter value is stored in the specified file. If the file name begins with a "/" then it is an absolute path. Otherwise, it is relative to VendRoot. The default file is C<etc/counter>. If the file does not exist, it is created and initialized to the value of the C<start> parameter.

The counter is implemented using Perl's C<File::Counter> module, which protects the file against simultaneous access by multiple processes.

\WARNING: This tag will not work under Safe, i.e. in embedded Perl.

Additional parameters:


H4: decrement=1

Causes the counter to count down instead of up.

H4: start=50

Causes a new counter to be created and to start from 50 (for example) if it did not exist before.

H4: value=1

Shows the value of the counter without incrementing or decrementing it.






H2: currency


H3: Summary

\Parameters: B<convert noformat>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Interpolates B<container text> by default>.

This is a container tag, i.e. [currency] FOO [/currency].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->currency(
>        {
>         convert => VALUE,
>         noformat => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->currency($convert, $noformat, $BODY);

 

H3: Description


When passed a value of a single number, formats it according to the
currency specification. For instance:

>    [currency]4[/currency]

will display:

>    4.00

or something else depending on the I<Locale> and PriceCommas settings. It
can contain a [calc] region. If the optional "convert" parameter is set,
it will convert the value according to PriceDivide> for the current
locale. If Locale is set to C<fr_FR>, and F<PriceDivide> for C<fr_FR>
is 0.167, the following sequence

>    [currency convert=1] [calc] 500.00 + 1000.00 [/calc] [/currency]

will cause the number 8.982,04 to be displayed.





H2: data


H3: Summary

\Parameters: B<table field key>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->data(
>        {
>         table => VALUE,
>         field => VALUE,
>         key => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->data($table, $field, $key, $ATTRHASH);

Attribute aliases

>            base ==> table
>            code ==> key
>            col ==> field
>            column ==> field
>            database ==> table
>            name ==> field
>            row ==> key


 

H3: Description


\Syntax:
\            [data table=db_table
                  column=column_name
                  key=key
                  filter="uc|lc|name|namecase|no_white|etc."*
                  append=1*
                  value="value to set to"*
                  increment=1*                         ]

Returns the value of the field in a database table, or (DEPRECATED) from
the C<session>
namespace. If the optional B<value> is supplied, the entry will be
changed to that value.  If the option increment* is present, the field
will be atomically incremented with the value in B<value>. Use negative
numbers in C<value> to decrement. The C<append> attribute causes the value
to be appended; and finally, the C<filter> attribute is a set of Interchange
filters that are applied to the data 1) after it is read; or 2)before it
is placed in the table.

If a DBM-based database is to be modified, it must be flagged writable
on the page calling the write tag. Use [tag flag write]products[/tag]
to mark the C<products> database writable, for example.
B<This must be done before ANY access to that table.>

N: Deprecated Behavior: (replace with C<session> tag).
In addition, the C<[data ...]> tag can access a number of elements in
the Interchange session database:

>    accesses           Accesses within the last 30 seconds
>    arg                The argument passed in a [page ...] or [area ...] tag
>    browser            The user browser string
>    cybercash_error    Error from last CyberCash operation
>    cybercash_result   Hash of results from CyberCash (access with usertag)
>    host               Interchange's idea of the host (modified by DomainTail)
>    last_error         The last error from the error logging
>    last_url           The current Interchange path_info
>    logged_in          Whether the user is logged in (add-on UserDB feature)
>    pageCount          Number of unique URLs generated
>    prev_url           The previous path_info
>    referer            HTTP_REFERER string
>    ship_message       The last error messages from shipping
>    source             Source of original entry to Interchange
>    time               Time (seconds since Jan 1, 1970) of last access
>    user               The REMOTE_USER string
>    username           User name logged in as (UserDB feature)

\NOTE: Databases will hide session values, so don't name a database "session".
or you won't be able to use the [data ...] tag to read them. Case is
sensitive, so in a pinch you could call the database "Session", but it
would be better not to use that name at all.





H2: default


H3: Summary

\Parameters: B<name default>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->default(
>        {
>         name => VALUE,
>         default => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->default($name, $default, $ATTRHASH);

 

H3: Description


Returns the value of the user form variable C<variable> if it is non-empty.
Otherwise returns C<default>, which is the string "default" if there is no
default supplied. Got that? This tag is DEPRECATED anyway.





H2: description


H3: Summary

\Parameters: B<code base>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->description(
>        {
>         code => VALUE,
>         base => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->description($code, $base);

 

H3: Description


Expands into the description of the product identified by code as found in the
products database. This is the value of the database field that corresponds to
the C<catalog.cfg> directive C<DescriptionField>. If there is more than one
products file defined, they will be searched in order unless constrained by the
optional argument B<base>.

This tag is especially useful for multi-language catalogs. The C<DescriptionField>
directive can be set for each locale and point to a different database field;
for example C<desc_en> for English, C<desc_fr> for French, etc.





H2: discount


H3: Summary

\Parameters: B<code>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [discount] FOO [/discount].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->discount(
>        {
>         code => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->discount($code, $BODY);

 

H3: Description


Product discounts can be set upon display of any page. The discounts
apply only to the customer receiving them, and are of one of three types:

>    1. A discount for one particular item code (code/key is the item-code)
>    2. A discount applying to all item codes (code/key is ALL_ITEMS)
>    3. A discount applied after all items are totaled
>       (code/key is ENTIRE_ORDER)

The discounts are specified via a formula. The formula is scanned for
the variables $q and $s, which are substituted for with the item
I<quantity> and I<subtotal> respectively. In the case of the item and
all items discount, the formula must evaluate to a new subtotal for all
items I<of that code> that are ordered. The discount for the entire
order is applied to the entire order, and would normally be a monetary
amount to subtract or a flat percentage discount.

Discounts are applied to the effective price of the product, including
any quantity discounts.

To apply a straight 20% discount to all items:

>    [discount ALL_ITEMS] $s * .8 [/discount]

or with named attributes:

>    [discount code=ALL_ITEMS] $s * .8 [/discount]

To take 25% off of only item 00-342:

>    [discount 00-342] $s * .75 [/discount]

To subtract $5.00 from the customer's order:

>    [discount ENTIRE_ORDER] $s - 5 [/discount]

To reset a discount, set it to the empty string: 

>    [discount ALL_ITEMS][/discount]

Perl code can be used to apply the discounts. Here is an example of a
discount for item code 00-343 which prices the I<second> one ordered at
1 cent:

>    [discount 00-343]
>    return $s if $q == 1;
>    my $p = $s/$q;
>    my $t = ($q - 1) * $p;
>    $t .= 0.01;
>    return $t;
>    [/discount]

If you want to display the discount amount, use the [item-discount] tag.

>    [item-list]
>    Discount for [item-code]: [item-discount]
>    [/item-list]

Finally, if you want to display the discounted subtotal in a way that
doesn't correspond to a standard Interchange tag, you can use the [calc] tag:

>    [item-list]
>    Discounted subtotal for [item-code]: [currency][calc]
>                                            [item-price noformat] * [item-quantity]
>                                            [/calc][/currency]
>    [/item-list]

%%
dump
%%
Prints a dump of the current user session as expanded by Data::Dumper.
Includes any CGI environment passed from the server.

For an example, create a page containing <XMP>[dump]</XMP> and see what
it displays.

%%
either
%%
The E<lbracket>{{C[jump="#either"]either}}]this[{{C[jump="#or"]or}}]that[/eitherE<rbracket> implements a check for the first
non-zero, non-blank value. It splits on [or], and then parses each
piece in turn. If a value returns true (in the Perl senseE<nbspace>E<emdash> non-zero, non-blank)
then subsequent pieces will be discarded without interpolation.

\Example:

>  [either][value must_be_here][or][bounce href="[area incomplete]"][/either]

Always strips leading and trailing whitespace.




H2: discount_subtotal


H3: Description

Inserts the discounted subtotal of the ordered items.



H2: dump


H3: Summary

No parameters.

Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->dump(
>        {
>        }
>    )
>
> OR
>
>    $Tag->dump($);

 

H3: Description

B<NO Description>




H2: ecml


H3: Summary

\Parameters: B<name function>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->ecml(
>        {
>         name => VALUE,
>         function => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->ecml($name, $function, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: either


H3: Summary

No parameters.

Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [either] FOO [/either].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->either(
>        {
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->either($BODY);

 

H3: Description

B<NO Description>




H2: error


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->error(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->error($name, $ATTRHASH);

 

H3: Description


>    [error var options]
>        var is the error name, e.g. "session"

The [error ...] tag is designed to manage form variable checking
for the Interchange C<submit> form processing action. It works in
conjunction with the definition set in C<mv_order_profile>, and can
generate error messages in any format you desire.

If the variable in question passes order profile checking, it will
output a label, by default B<bold> text if the item is required,
or normal text if not (controlled by the <require> parameter. If
the variable fails one or more order checks, the error message
will be substituted into a template and the error cleared from
the user's session.

(Below is as of 4.03, the equivalent in 4.02 is
\[if type=explicit compare="[error all=1 keep=1]"] ... [/if].)

To check errors without clearing them, you can use the idiom:

>    [if errors]
>    <FONT SIZE="+1" COLOR=RED>
>        There were errors in your form submission.
>    </FONT>
>    <BLOCKQUOTE>
>        [error all=1 show_error=1 joiner="<BR>"]
>    </BLOCKQUOTE>
>    [/if]

The options are:


H4: all=1

Display all error messages, not just the one
refered to by <var>. The default is only display
the error message assigned to <var>.

text=<optional string to embed the error message(s) in>

place a "%s" somewhere in 'text' to mark where
you want the error message placed, otherwise it's
appended on the end. This option also implies
show_error.

H4: joiner=<char>

Character used to join multiple error messages.
Default is '\n', a newline.

H4: keep=1

keep=1 means don't delete the error messages after
copy; anything else deletes them.

H4: show_error=1

show_error=1 means return the error message text;
otherwise just the number of errors found is returned.

H4: show_label=1

show_label=1 causes the field label set by a previous [error] tag's std_label attribute (see below) to be included as part of the error message, like this:

E:First Name: blank

If no std_label was set, the variable name will be used instead. This can also be used in combination with show_var to show both the label and the variable name.

show_label was added in 4.7.0.

H4: show_var=1

show_var=1 includes the name of the variable the error was found in as part of the error message, like this:

E:email: 'bob#nothing,net' not a valid email address

H4: std_label

std_label=<label string for error message>

used with 'required' to display a standardized
error format. The HTML formating can bet set
via the global variable MV_ERROR_STD_LABEL with
the default being:

>        <FONT COLOR=RED>label_str<SMALL><I>(%s)</I></SMALL></FONT>

where <label_str> is what you set std_label to and %s
is substituted with the error message. This option
can not be used with the text= option.

H4: required=1

Specifies that this is a required field for formatting purposes.
In the std_label format, it means the field will be bolded.
If you specify your own label string, it will insert HTML anywhere
you have {REQUIRED: HTML}, but only when the field is required.





H2: export


H3: Summary

\Parameters: B<table>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->export(
>        {
>         table => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->export($table, $ATTRHASH);

Attribute aliases

>            base ==> table
>            database ==> table


 

H3: Description

B<NO Description>




H2: field


H3: Summary

\Parameters: B<name code>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->field(
>        {
>         name => VALUE,
>         code => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->field($name, $code);

Attribute aliases

>            col ==> name
>            column ==> name
>            field ==> name
>            key ==> code
>            row ==> code


 

H3: Description


HTML example: <PARAM MV=field MV.COL=column MV.ROW=key>

Expands into the value of the field I<name> for the product
identified by I<code> as found by searching the products database.
It will return the first entry found in the series of I<Product Files>.
the products database. If you want to constrain it to a particular
database, use the [data base name code] tag.

Note that if you only have one ProductFile C<products>, which is the default,
C<[field column key]> is the same as C<[data products column key]>.





H2: file


H3: Summary

\Parameters: B<name type>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->file(
>        {
>         name => VALUE,
>         type => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->file($name, $type);

 

H3: Description


Inserts the contents of the named file. The file should normally
be relative to the catalog directoryE<nbspace>E<emdash> file names beginning with
/ or .. are not allowed if the Interchange server administrator
has set I<NoAbsolute> to C<Yes>.

The optional C<type> parameter will do an appropriate ASCII translation
on the file before it is sent.





H2: filter


H3: Summary

\Parameters: B<op>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [filter] FOO [/filter].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->filter(
>        {
>         op => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->filter($op, $BODY);

 

H3: Description


Applies any of Interchange's standard filters to an arbitrary value, or 
you may define your own. The filters are also available as parameters
to the C<cgi>, C<data>, and C<value> tags.

Filters can be applied in sequence and as many as needed can be
applied.

Here is an example. If you store your author or artist names in the
database "LAST, First" so that they sort properly, you still might
want to display them normally as "First Last". This call

>    [filter op="name namecase"]WOOD, Grant[/filter]

will display as

>    Grant Wood

Another way to do this would be:

>    [data table=products column=artist key=99-102 filter="name namecase"]

Filters available include:


H4: cgi

Returns the value of the CGI variable. Useful for starting a filter
sequence with a seed value.

>    'cgi' =>    sub {
>                    return $CGI::values(shift);
>                },

H4: digits

Returns only digits.

>    'digits' => sub {
>                    my $val = shift;
>                    $val =~ s/\D+//g;
>                    return $val;
>                },

H4: digits_dot

Returns only digits and periods, i.e. [.0-9]. Useful for decommifying
numbers.

>    'digits_dot' => sub {
>                    my $val = shift;
>                    $val =~ s/[^\d.]+//g;
>                    return $val;
>                },

H4: dos

Turns linefeeds into carriage-return / linefeed pairs.

>    'dos' =>    sub {
>                    my $val = shift;
>                    $val =~ s/\r?\n/\r\n/g;
>                    return $val;
>                },

H4: entities

Changes C<<> to C<&lt;>, C<"> to C<&quot;>, etc.

>    'entities' => sub {
>                    return HTML::Entities::encode(shift);
>                },



H4: gate

Performs a security screening by testing to make sure a corresponding
scratch variable has been set.

>    'gate' =>   sub {
>                    my ($val, $var) = @_;
>                    return '' unless $::Scratch->{$var};
>                    return $val;
>                },

H4: lc

Lowercases the text.

>    'lc' =>     sub {
>                    return lc(shift);
>                },

H4: lookup

Looks up an item in a database based on the passed table and
column. Call would be:

>    [filter op="uc lookup.country.name"]us[/filter]

This would be the equivalent of [data table=country column=name key=US].

>    'lookup' => sub {
>                        my ($val, $tag, $table, $column) = @_;
>                        return tag_data($table, $column, $val) || $val;
>                },

H4: mac

Changes newlines to carriage returns.

>    'mac' =>    sub {
>                    my $val = shift;
>                    $val =~ s/\r?\n|\r\n?/\r/g;
>                    return $val;
>                },

H4: name

Transposes a LAST, First name pair.

>    'name' => sub {
>                    my $val = shift;
>                    return $val unless $val =~ /,/;
>                    my($last, $first) = split /\s*,\s*/, $val, 2;
>                    return "$first $last";
>                },

H4: namecase

Namecases the text. Only works on values that are uppercase in the first
letter, i.e. [filter op=namecase]LEONARDO da Vinci[/filter] will return
"Leonardo da Vinci".

>    'namecase' => sub {
>                    my $val = shift;
>                    $val =~ s/([A-Z]\w+)/\L\u$1/g;
>                    return $val;
>                },

H4: no_white

Strips all whitespace.

>    'no_white' =>   sub {
>                    my $val = shift;
>                    $val =~ s/\s+//g;
>                    return $val;
>                },

H4: pagefile

Strips leading slashes and dots.

>    'pagefile' => sub {
>                    $_[0] =~ s:^[./]+::;
>                    return $_[0];
>                },

H4: sql

Change single-quote characters into doubled versions, i.e. ' becomes ''.

>    'sql'       => sub {
>                    my $val = shift;
>                    $val =~ s:':'':g; # '
>                    return $val;
>                },

H4: strip

Strips leading and trailing whitespace.

>    'strip' =>  sub {
>                    my $val = shift;
>                    $val =~ s/^\s+//;
>                    $val =~ s/\s+$//;
>                    return $val;
>                },

H4: text2html

Rudimentary HTMLizing of text.

>    'text2html' => sub {
>                    my $val = shift;
>                    $val =~ s|\r?\n\r?\n|<P>|;
>                    $val =~ s|\r?\n|<BR>|;
>                    return $val;
>                },


H4: uc

Uppercases the text.

>    'uc' =>     sub {
>                    return uc(shift);
>                },

H4: unix

Removes those crufty carriage returns.

>    'unix' =>   sub {
>                    my $val = shift;
>                    $val =~ s/\r?\n/\n/g;
>                    return $val;
>                },

H4: urlencode

Changes non-word characters (except colon) to %3c notation.

>    'urlencode' => sub {
>                    my $val = shift;
>                    $val =~ s|[^\w:]|sprintf "%%%02x", ord $1|eg;
>                    return $val;
>                },

H4: value

Returns the value of the user session variable. Useful for starting a filter
sequence with a seed value.

>    'value' =>  sub {
>                    return $::Values->(shift);
>                },

H4: word

Only returns word characters. Locale does apply if collation is properly set.

>    'word' =>   sub {
>                    my $val = shift;
>                    $val =~ s/\W+//g;
>                    return $val;
>                },

You can define your own filters in an GlobalSub (or Sub or ActionMap):

>    package Vend::Interpolate;
>
>    $Filter{reverse} = sub { $val = shift; return scalar reverse $val  };

That filter will reverse the characters sent.

The arguments sent to the subroutine are the value to be filtered,
any associated variable or tag name, and any arguments appended
to the filter name with periods as the separator.

A C<[filter op=lookup.products.price]99-102[/filter]> will send
('99-102', undef, 'products', 'price') as the parameters. Assuming
the value of the user variable C<foo> is C<bar>, the call
C<[value name=foo filter="lookup.products.price.extra"]> will send
('bar', 'foo', 'products', 'price', 'extra').






H2: flag


H3: Summary

\Parameters: B<type>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->flag(
>        {
>         type => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->flag($type, $ATTRHASH);

Attribute aliases

>            flag ==> type
>            name ==> type


 

H3: Description

B<NO Description>




H2: fly_list


H3: Summary

\Parameters: B<code base>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [fly_list] FOO [/fly_list].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->fly_list(
>        {
>         code => VALUE,
>         base => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->fly_list($code, $base, $BODY);

 

H3: Description


\Syntax: [fly-list prefix=tag_prefix* code=code*]

Defines an area in a random page which performs the flypage lookup
function, implementing the tags below.

>   [fly-list]
>    (contents of flypage.html)
>   [/fly-list]

If you place the above around the contents of the demo flypage, 
in a file named C<flypage2.html>, it will make these two calls
display identical pages:

>    [page 00-0011] One way to display the Mona Lisa [/page]
>    [page flypage2 00-0011] Another way to display the Mona Lisa [/page]

If you place a [fly-list] tag alone at the top of the page, it will
cause any page to act as a flypage.

By default, the prefix is C<item>, meaning the C<[item-code]> tag will
display the code of the item, the C<[item-price]> tag will display price, etc.
But if you use the prefix, i.e. C<[fly-list prefix=fly]>, then it will
be [fly-code]; C<prefix=foo> would cause C<[foo-code]>, etc.





H2: fly_tax


H3: Summary

\Parameters: B<area>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->fly_tax(
>        {
>         area => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->fly_tax($area);

 

H3: Description

Builds a tax rate from C<taxarea>, C<taxrate>, C<taxshipping>, variable values, and the C<SalesTax> directive value.




H2: goto


H3: Summary

\Parameters: B<name if>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->goto(
>        {
>         name => VALUE,
>         if => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->goto($name, $if);

 

H3: Description

B<NO Description>




H2: handling


H3: Summary

\Parameters: B<mode>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->handling(
>        {
>         mode => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->handling($mode, $ATTRHASH);

Attribute aliases

>            carts ==> cart
>            modes ==> mode
>            name ==> mode
>            tables ==> table


 

H3: Description

Calculates and inserts handling costs. Accepts the same noformat and convert arguments as the shipping tag.




H2: harness


H3: Summary

No parameters.

B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [harness] FOO [/harness].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->harness(
>        {
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->harness($ATTRHASH, $BODY);

 

H3: Description

B<NO Description>



H2: href

Alias for [{{CMD[jump="#area"]area}}] tag.


H2: html_table


H3: Summary

No parameters.

B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [html_table] FOO [/html_table].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->html_table(
>        {
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->html_table($ATTRHASH, $BODY);

 

H3: Description

B<NO Description>




H2: if


H3: Summary

\Parameters: B<type term op compare>

THIS TAG HAS SPECIAL POSITIONAL PARAMETER HANDLING.



Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [if] FOO [/if].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

Called Routine for positonal: 

B<ASP-like Perl call:>

>    $Tag->if(
>        {
>         type => VALUE,
>         term => VALUE,
>         op => VALUE,
>         compare => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->if($type, $term, $op, $compare, $BODY);

Attribute aliases

>            base ==> type
>            comp ==> compare
>            condition ==> compare
>            operator ==> op


 

H3: Description


Named call example: [if type="type" term="field" op="op" compare="compare"]

Positional call example: [if type field op compare]

negated: [if type="!type" term="field" op="op" compare="compare"]

Positional call example: [if !type field op compare]

Allows conditional building of HTML based on the setting of various Interchange
session and database values. The general form is:

>    [if type term op compare]
>    [then]
>                                If true, this is printed on the document.
>                                The [then] [/then] is optional in most
>                                cases. If ! is prepended to the type
>                                setting, the sense is reversed and
>                                this will be output for a false condition.
>    [/then]
>    [elsif type term op compare]
>                                Optional, tested when if fails
>    [/elsif] 
>    [else]
>                                Optional, printed when all above fail
>    [/else]
>    [/if]

The E<lbracket>{{C[jump="#if"]if}}E<rbracket> tag can also have some variants:

>    [if type=explicit compare=`$perl_code`]
>        Displayed if valid Perl CODE returns a true value.
>    [/if]

You can do some Perl-style regular expressions:

>    [if value name =~ /^mike/]
>                                This is the if with Mike.
>    [elsif value name =~ /^sally/]
>                                This is an elsif with Sally.
>    [/elsif]
>    [elsif value name =~ /^pat/]
>                                This is an elsif with Pat.
>    [/elsif]
>    [else]
>                                This is the else, no name I know.
>    [/else]
>    [/if]

While named parameter tag syntax works for C<[if ...]>, it is more convenient
to use positional calls in most cases.
The only exception is if you are planning on doing a test on the 
results of another tag sequence:
    
>    [if value name =~ /[value b_name]/]
>        Shipping name matches billing name.
>    [/if]

Oops!  This will not work. You must do instead

>    [if base=value field=name op="=~" compare="/[value b_name]/"]
>        Shipping name matches billing name.
>    [/if]

or better yet

>    [if type=explicit compare=`
>                        $Value->{name} =~ /$Value->{b_name}/
>                        `]
>        Shipping name matches billing name.
>    [/if]

Interchange also supports a limited [and ...] and [or ...]
capability:

>    [if value name =~ /Mike/]
>    [or value name =~ /Jean/]
>    Your name is Mike or Jean.
>    [/if]
>
>    [if value name =~ /Mike/]
>    [and value state =~ /OH/]
>    Your name is Mike and you live in Ohio.
>    [/if]

If you wish to do very complex AND and OR operations, you will have to use 
C<[if explicit]> or better yet embedded Perl/ASP. This allows complex
testing and parsing of values.

There are many test targets available:


H4: config Directive

The Interchange configuration variables. These are set
by the directives in your Interchange configuration file (or
the defaults).

>    [if config CreditCardAuto]
>    Auto credit card validation is enabled.
>    [/if]

H4: data  database::field::key

The Interchange databases. Retrieves a field in the database and
returns true or false based on the value.

>    [if data products::size::99-102]
>    There is size information.
>    [else]
>    No size information.
>    [/else]
>    [/if]
>
>    [if data products::size::99-102 =~ /small/i]
>    There is a small size available.
>    [else]
>    No small size available.
>    [/else]
>    [/if]

H4: discount

Checks to see if a discount is present for an item.

>    [if discount 99-102]
>    Item is discounted.
>    [/if]

H4: explicit

A test for an explicit value. If perl code is placed between
a [condition] [/condition] tag pair, it will be used to make
the comparison. Arguments can be passed to import data from
user space, just as with the [perl] tag.

>    [if explicit]
>    [condition]
>        $country = '[value country]';
>        return 1 if $country =~ /u\.?s\.?a?/i;
>        return 0;
>    [/condition]
>    You have indicated a US address.
>    [else]
>    You have indicated a non-US address. 
>    [/else]
>    [/if]

This example is a bit contrived, as the same thing could be
accomplished with [if value country =~ /u\.?s\.?a?/i], but
you will run into many situations where it is useful.

This will work for I<Variable> values:

>    [if type=explicit compare="__MYVAR__"] .. [/if]

H4: file

Tests for existence of a file. Useful for placing image
tags only if the image is present.

>    [if file /home/user/www/images/[item-code].gif]
>    <IMG SRC="[item-code].gif">
>    [/if]

The C<file> test requires that the I<SafeUntrap> directive contains
C<ftfile> (which is the default).

H4: items

The Interchange shopping carts. If not specified, the cart
used is the main cart. Usually used as a litmus test to
see if anything is in the cart, for example:

>  [if items]You have items in your shopping cart.[/if]
>
>  [if items layaway]You have items on layaway.[/if]

H4: ordered

Order status of individual items in the Interchange shopping
carts. If not specified, the cart used is the main cart.
The following items refer to a part number of 99-102.

>  [if ordered 99-102] Item 99-102 is in your cart. [/if]
>    Checks the status of an item on order, true if item
>    99-102 is in the main cart.
>
>  [if ordered 99-102 layaway] ... [/if]
>    Checks the status of an item on order, true if item
>    99-102 is in the layaway cart.
>
>  [if ordered 99-102 main size] ... [/if]
>    Checks the status of an item on order in the main cart,
>    true if it has a size attribute.
>
>  [if ordered 99-102 main size =~ /large/i] ... [/if]
>    Checks the status of an item on order in the main cart,
>    true if it has a size attribute containing 'large'.
>
>    To make sure it is exactly large, you could use:
>
>  [if ordered 99-102 main size eq 'large'] ... [/if]

H4: scratch

The Interchange scratchpad variables, which can be set
with the [set name]value[/set] element. 

>    [if scratch mv_separate_items]
>    ordered items will be placed on a separate line.
>    [else]
>    ordered items will be placed on the same line.
>    [/else]
>    [/if]

H4: session

the interchange session variables. of particular interest
are i<login>, i<frames>, i<secure>, and i<browser>.

H4: validcc

a special case, takes the form [if validcc no type exp_date].
evaluates to true if the supplied credit card number, type
of card, and expiration date pass a validity test. does
a luhn-10 calculation to weed out typos or phony 
card numbers. Uses the standard C<CreditCardAuto> variables
for targets if nothing else is passed.

H4: value

the interchange user variables, typically set in search,
control, or order forms. variables beginning with c<mv_>
are interchange special values, and should be tested/used
with caution.


The I<field> term is the specifier for that area. For example, [if session
logged_in] would return true if the C<logged_in> session parameter was set.

As an example, consider buttonbars for frame-based setups. It would be
nice to display a different buttonbar (with no frame targets) for sessions
that are not using frames:

>    [if scratch frames]
>        __BUTTONBAR_FRAMES__
>    [else]
>        __BUTTONBAR__
>    [/else]
>    [/if]

Another example might be the when search matches are displayed. If
you use the string '[value mv_match_count] titles found', it will display
a plural for only one match. Use:

>    [if value mv_match_count != 1]
>        [value mv_match_count] matches found.
>    [else]
>        Only one match was found.
>    [/else]
>    [/if]

The I<op> term is the compare operation to be used. Compare operations are
as in Perl:

>    ==  numeric equivalence
>    eq  string equivalence
>    >   numeric greater-than
>    gt  string greater-than
>    <   numeric less-than
>    lt  string less-than
>    !=  numeric non-equivalence
>    ne  string equivalence

Any simple perl test can be used, including some limited regex matching.
More complex tests are best done with C<[if explicit]>.


H4: [then] text [/then]

This is optional if you are not nesting if conditions, as the text
immediately following the [if ..] tag is used as the conditionally
substituted text. If nesting [if ...] tags you should use a [then][/then]
on any outside conditions to ensure proper interpolation.

H4: [elsif type field op* compare*]

named attributes: [elsif type="type" term="field" op="op" compare="compare"]

Additional conditions for test, applied if the initial C<[if ..]> test
fails.

H4: [else] text [/else]

The optional else-text for an if or if_field conditional.

H4: [condition] text [/condition]

Only used with the [if explicit] tag. Allows an arbitrary expression
B<in Perl> to be placed inside, with its return value interpreted as
the result of the test. If arguments are added to [if explicit args],
those will be passed as arguments are in the I<[perl]> construct.






H2: import


H3: Summary

\Parameters: B<table type>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Interpolates B<container text> by default>.

This is a container tag, i.e. [import] FOO [/import].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->import(
>        {
>         table => VALUE,
>         type => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->import($table, $type, $ATTRHASH, $BODY);

Attribute aliases

>            base ==> table
>            database ==> table


 

H3: Description


Named attributes:

>    [import table=table_name
>            type=(TAB|PIPE|CSV|%%|LINE)
>            continue=(NOTES|UNIX|DITTO)
>            separator=c]

Import one or more records into a database. The C<type> is any
of the valid Interchange delimiter types, with the default being defined
by the setting of the database I<DELIMITER>. The table must already be a defined
Interchange database table; it cannot be created on the fly. (If you need
that, it is time to use SQL.)

The C<type> of C<LINE> and C<continue> setting of C<NOTES> is particularly
useful, for it allows you to name your fields and not have to remember
the order in which they appear in the database. The following two imports
are identical in effect:

>    [import table=orders]
>    code: [value mv_order_number]
>    shipping_mode: [shipping-description]
>    status: pending
>    [/import]
>
>    [import table=orders]
>    shipping_mode: [shipping-description]
>    status: pending
>    code: [value mv_order_number]
>    [/import]

The C<code> or key must always be present, and is always named C<code>.

If you do not use C<NOTES> mode, you must import the fields in the
same order as they appear in the ASCII source file.

The C<[import ....] TEXT [/import]> region may contain multiple records.
If using C<NOTES> mode, you must use a separator, which by default is
a form-feed character (^L).





H2: include


H3: Summary

\Parameters: B<file locale>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->include(
>        {
>         file => VALUE,
>         locale => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->include($file, $locale);

 

H3: Description


Same as C<[file name]> except interpolates for all Interchange tags
and variables. Does NOT do locale translations.





H2: index


H3: Summary

\Parameters: B<table>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->index(
>        {
>         table => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->index($table, $ATTRHASH);

Attribute aliases

>            base ==> table
>            database ==> table


 

H3: Description

B<NO Description>




H2: input_filter


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [input_filter] FOO [/input_filter].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->input_filter(
>        {
>         name => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->input_filter($name, $ATTRHASH, $BODY);

Attribute aliases

>            ops ==> op
>            var ==> name
>            variable ==> name


 

H3: Description

B<NO Description>




H2: item_list


H3: Summary

\Parameters: B<name>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [item_list] FOO [/item_list].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->item_list(
>        {
>         name => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->item_list($name, $ATTRHASH, $BODY);

Attribute aliases

>            cart ==> name


 

H3: Description


Within any page, the [item_list cart*] element shows a list of all the
items ordered by the customer so far. It works by repeating the source
between [item_list] and [/item_list] once for each item ordered.

\NOTE: The special tags that reference item within the list are not normal
Interchange tags, do not take named attributes, and cannot be contained in
an HTML tag (other than to substitute for one of its values or provide
a conditional container). They are interpreted only inside their
corresponding list container. Normal Interchange tags can be interspersed,
though they will be interpreted I<after> all of the list-specific tags.

Between the item_list markers the following elements will return
information for the current item:


H4: E<lbracket>if-data table column]

If the database field C<column> in table I<table> is non-blank, the
following text up to the [/if_data] tag is substituted. This can be
used to substitute IMG or other tags only if the corresponding source
item is present. Also accepts a [else]else text[/else] pair for the
opposite condition.

H4: E<lbracket>if-data ! table column]

Reverses sense for [if-data].

H4: E<lbracket>/if-data]

Terminates an [if_data table column] element.

H4: E<lbracket>if-field fieldname]

If the products database field I<fieldname> is non-blank, the following
text up to the [/if_field] tag is substituted. If you have more than
one products database table (see I<ProductFiles>), it will check
them in order until a matching key is found. This can be used to
substitute IMG or other tags only if the corresponding source
item is present. Also accepts a [else]else text[/else] pair
for the opposite condition.

H4: E<lbracket>if-field ! fieldname]

Reverses sense for [if-field].

H4: E<lbracket>/if-field]

Terminates an [if_field fieldname] element.

H4: E<lbracket>item-accessories attribute*, type*, field*, database*, name*]

Evaluates to the value of the Accessories database entry for the item.
If passed any of the optional arguments, initiates special processing
of item attributes based on entries in the product database.

H4: E<lbracket>item-code]

Evaluates to the product code for the current item.

H4: E<lbracket>item-data database fieldname]

Evaluates to the field name I<fieldname> in the arbitrary database
table I<database>, for the current item.

H4: E<lbracket>item-description]

Evaluates to the product description (from the products file)
for the current item.

In support of C<OnFly>, if the description field is not found in the database,
the C<description> setting in the shopping cart will be used instead.

H4: E<lbracket>item-field fieldname]

Evaluates to the field name I<fieldname> in the products database,
for the current item. If the item is not found in the first of the
I<ProductFiles>, all will be searched in sequence.

H4: E<lbracket>item-increment]

Evaluates to the number of the item in the match list. Used
for numbering search matches or order items in the list.

H4: E<lbracket>item-last]tags[/item-last]

Evaluates the output of the Interchange tags encased inside the tags,
and if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1)
then the list iteration will terminate. If the evaluated number is
B<negative>, then the item itself will be skipped. If the evaluated
number is B<positive>, then the item itself will be shown but will be
last on the list.

>      [item-last][calc]
>        return -1 if '[item-field weight]' eq '';
>        return 1 if '[item-field weight]' < 1;
>        return 0;
>        [/calc][/item-last]

If this is contained in your
E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket> (or
E<lbracket>{{C[jump="#search_list"]search-list}}E<rbracket> or
flypage) and the weight field is empty, then a numerical C<-1> will be
output from the [calc][/calc] tags; the list will end and the item
will B<not> be shown. If the product's weight field is less than 1, a
numerical 1 is output.  The item will be shown, but will be the last
item shown. (If it is an
E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket>, any price for
the item will still be added to the subtotal.) NOTE: no HTML style.

H4: E<lbracket>item-modifier attribute]

Evaluates to the modifier value of C<attribute> for the current item.

H4: E<lbracket>item-next]tags[/item_next]

Evaluates the output of the Interchange tags encased inside, and
if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1) then
the item will be skipped with no output. Example:

>      [item-next][calc][item-field weight] < 1[/calc][/item-next]

If this is contained in your E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket> (or E<lbracket>{{C[jump="#search_list"]search-list}}E<rbracket> or flypage)
and the product's weight field is less than 1, then a numerical C<1> will
be output from the [calc][/calc] operation. The item will not be shown. (If
it is an E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket>, any price for the item will still be added to the
subtotal.)

H4: E<lbracket>item-price n* noformat*]

Evaluates to the price for quantity C<n> (from the products file)
of the current item, with currency formatting. If the optional "noformat"
is set, then currency formatting will not be applied.

H4: E<lbracket>discount-price n* noformat*]

Evaluates to the discount price for quantity C<n> (from the products file)
of the current item, with currency formatting. If the optional "noformat"
is set, then currency formatting will not be applied. Returns regular
price if not discounted.

H4: E<lbracket>item-discount]

Returns the difference between the regular price and the discounted price.

H4: E<lbracket>item-quantity]

Evaluates to the quantity ordered for the current item.

H4: E<lbracket>item-subtotal]

Evaluates to the subtotal (quantity * price) for the current item.
Quantity price breaks are taken into account.

H4: E<lbracket>modifier-name attribute]

Evaluates to the name to give an input box in which the
customer can specify the modifier to the ordered item.

H4: E<lbracket>quantity-name]

Evaluates to the name to give an input box in which the
customer can enter the quantity to order.






H2: label


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->label(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->label($name);

 

H3: Description

B<NO Description>




H2: log


H3: Summary

\Parameters: B<file>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [log] FOO [/log].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->log(
>        {
>         file => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->log($file, $ATTRHASH, $BODY);

Attribute aliases

>            arg ==> file


 

H3: Description

B<NO Description>




H2: loop


H3: Summary

\Parameters: B<list>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [loop] FOO [/loop].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->loop(
>        {
>         list => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->loop($list, $ATTRHASH, $BODY);

Attribute aliases

>            arg ==> list
>            args ==> list


 

H3: Description


HTML example: 

>    <TABLE><TR MV="loop 1 2 3"><TD>[loop-code]</TD></TR></TABLE>

Returns a string consisting of the LIST, repeated for every item in a
comma-separated or space-separated list. Operates in the same fashion
as the [item-list] tag, except for order-item-specific values. Intended
to pull multiple attributes from an item modifierE<nbspace>E<emdash> but can be useful
for other things, like building a pre-ordained product list on a page.

Loop lists can be nested reliably in Interchange by using the
prefix="tag" parameter. New syntax:

>    [loop arg="A B C"]
>        [loop prefix=mid arg="[loop-code]1 [loop-code]2 [loop-code]3"]
>            [loop prefix=inner arg="X Y Z"]
>                [mid-code]-[inner-code]
>            [/loop]
>        [/loop]
>    [/loop]

You can do an arbitrary search with the search="args" parameter, just
as in a one-click search:

>    [loop search="se=Americana/sf=category"]
>        [loop-code] [loop-field title]
>    [/loop]

The above will show all items with a category containing the whole world
"Americana", and will work the same in both old and new syntax.


H4: E<lbracket>if-loop-data table column] IF [else] ELSE [/else][/if-loop-field]

Outputs the IF if the C<column> in C<table> is non-empty, and the ELSE (if any)
otherwise.

See [if-PREFIX-data].

H4: E<lbracket>if-loop-field column] IF [else] ELSE [/else][/if-loop-field]

Outputs the B<IF> if the C<column> in the C<products> table is non-empty,
and the B<ELSE> (if any) otherwise. Will fall through to the first
non-empty field if there are multiple C<ProductFiles>.

See [if-PREFIX-field].

H4: E<lbracket>if-loop-param param] IF [else] ELSE [/else][/if-loop-param]

Only works if you have named return fields from a search (or from a
passed list with the lr=1 parameter).

Outputs the B<IF> if the returned C<param> is non-empty, and the
B<ELSE> (if any) otherwise.

See [if-PREFIX-param].

H4: E<lbracket>if-loop-pos N] IF [else] ELSE [/else][/if-loop-param]

Only works if you have multiple return fields from a search (or from a
passed list with the lr=1 parameter).

Parameters are numbered from ordinal 0, with [loop-pos 0] being the
equivalent of [loop-code].

Outputs the B<IF> if the returned positional parmeter C<N> is
non-empty, and the B<ELSE> (if any) otherwise.

See [if-PREFIX-pos].

H4: E<lbracket>loop-accessories]

Outputs an [accessories ...] item.

See [PREFIX-accessories].

H4: E<lbracket>loop-change marker]

See [PREFIX-change].

H4: E<lbracket>loop-code]

Evaluates to the code for the current item.

See [PREFIX-code].

H4: E<lbracket>loop-data database fieldname]

Evaluates to the field name I<fieldname> in the arbitrary database
table I<database>, for the current item.

See [PREFIX-data].

H4: E<lbracket>loop-description]

Evaluates to the product description (from the products file, passed
description in on-fly item, or description attribute in cart)
for the current item.

See [PREFIX-description].

H4: E<lbracket>loop-field fieldname]

Evaluates to the field name I<fieldname> in the database,  for
the current item.

See [PREFIX-field].

H4: E<lbracket>loop-increment]

Evaluates to the number of the item in the list. Used
for numbering items in the list.

Starts from integer 1.

See [PREFIX-increment].

H4: E<lbracket>loop-last]tags[/loop-last]

Evaluates the output of the Interchange tags encased inside,
and if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1)
then the loop iteration will terminate. If the evaluated number is
B<negative>, then the item itself will be skipped. If the evaluated
number is B<positive>, then the item itself will be shown but will be
last on the list.

>      [loop-last][calc]
>        return -1 if '[loop-field weight]' eq '';
>        return 1 if '[loop-field weight]' < 1;
>        return 0;
>        [/calc][/loop-last]

If this is contained in your C<[loop list]> and the weight field is empty,
then a numerical C<-1> will be output from the [calc][/calc] tags; the
list will end and the item will B<not> be shown. If the product's weight
field is less than 1, a numerical 1 is output.  The item will be shown,
but will be the last item shown.

H4: E<lbracket>loop-next]tags[/loop-next]

Evaluates the output of the Interchange tags encased inside, and
if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1) then
the loop will be skipped with no output. Example:

>      [loop-next][calc][loop-field weight] < 1[/calc][/loop-next]

If this is contained in your C<[loop list]> and the product's weight
field is less than 1, then a numerical C<1> will be output from the
\[calc][/calc] operation. The item will not be shown.

H4: E<lbracket>loop-price n* noformat*]

Evaluates to the price for optional quantity n (from the products file)
of the current item, with currency formatting. If the optional "noformat"
is set, then currency formatting will not be applied.






H2: mail


H3: Summary

\Parameters: B<to>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [mail] FOO [/mail].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->mail(
>        {
>         to => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->mail($to, $ATTRHASH, $BODY);

 

H3: Description

B<NO Description>




H2: mvasp


H3: Summary

\Parameters: B<tables>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [mvasp] FOO [/mvasp].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->mvasp(
>        {
>         tables => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->mvasp($tables, $ATTRHASH, $BODY);

Attribute aliases

>            table ==> tables


 

H3: Description

B<NO Description>




H2: nitems


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->nitems(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->nitems($name, $ATTRHASH);

 

H3: Description


Expands into the total number of items ordered so far. Takes an
optional cart name as a parameter.





H2: onfly


H3: Summary

\Parameters: B<code quantity>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->onfly(
>        {
>         code => VALUE,
>         quantity => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->onfly($code, $quantity, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: options


H3: Summary

\Parameters: B<code>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->options(
>        {
>         code => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->options($code, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: or


H3: Summary

\Parameters: B<type term op compare>

THIS TAG HAS SPECIAL POSITIONAL PARAMETER HANDLING.



Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

Called Routine for positonal: 

B<ASP-like Perl call:>

>    $Tag->or(
>        {
>         type => VALUE,
>         term => VALUE,
>         op => VALUE,
>         compare => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->or($type, $term, $op, $compare);

Attribute aliases

>            base ==> type
>            comp ==> compare
>            operator ==> op


 

H3: Description

B<NO Description>




H2: order


H3: Summary

\Parameters: B<code quantity>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->order(
>        {
>         code => VALUE,
>         quantity => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->order($code, $quantity);

 

H3: Description


Expands into a hypertext link which will include the specified
code in the list of products to order and display the order page. B<code>
should be a product code listed in one of the "products" databases. The
optional argument B<cart/page> selects the shopping cart the item will be
placed in (begin with / to use the default cart C<main>) and the order page
that will display the order. The optional argument B<database> constrains
the order to a particular products fileE<nbspace>E<emdash> if not specified, all databases
defined as products files will be searched in sequence for the item.

\Example: 

>  Order a [order TK112]Toaster[/order] today.

\Note: [/order] simply expands to </A>.





H2: page

Expands to a hyperlink to an Interchange page or action, including
surrounding E<lt>AE<nbspace>HREFE<nbspace>...E<gt>. The URL within the
link includes the Interchange session ID and supplied arguments. The
optional [/page] is simply a macro for E<lt>/AE<gt>.

If you do not want the E<lt>AE<nbspace>HREFE<nbspace>...E<gt>, use the
{{CMD[jump="#area"]area}} tag insteadE<nbspace>E<emdash> these are
equivalent:
>    [page href=dir/page arg=mv_arg]TargetName[/page]
>    <A HREF="[area href=dir/page arg=mv_arg]">TargetName</A>


H3: Summary

!block example;
    [B<page> href arg I<other named attributes>]
    [B<page> href=dir/page arg=page_arguments I<other named attributes>]
!endblock


#!block table; style="plain"; colvaligns="TTT"
!block table; colvaligns="TTT"
Parameters|Description|Default
href|<<
Path to Interchange page or action
. I<Special arguments>
** 'scan' treats B<arg> as a search argument
** 'http://...' external link (requires B<form> attribute)
>>|process
arg|Interchange arguments to page or action|I<none>
I<base>|alias for B<arg>|I<none>
!endblock

#!block table; style="plain"; colvaligns="TT"
!block table; colvaligns="TT"
Attributes|Default
{{CMD[jump="#page_extra"]extra}}|I<none>
{{CMD[jump="#page_form"]form}}|I<none>
{{CMD[jump="#page_search"]search}}|I<No>
{{CMD[jump="#page_secure"]secure}}|I<No>
{{CMD[jump="#attr_interpolate"]interpolate (reparse)}}|I<No>
!endblock

#!block table; style="plain";headings=1; colvaligns="TT"
!block table;headings=1; colvaligns="TT"
A|B
Other_Charactreristics|
Invalidates cache|I<No>
Macro|I<No>
Has end tag|I<No> (C<[/page]> is a macro for C<E<lt>/AE<gt>>)
!endblock

B<Tag expansion example:>

!block example
   [page href=dir/page.html arg="arg1=AA/arg2=BB"]

   <a href="[[EXAMPLE_DOMAIN]]/cgi-bin/[[EXAMPLE_CATALOG]]/page.html?mv_session_id=[[EXAMPLE_SESSION]]&\
   mv_pc=1&mv_arg=arg1%3dAA/arg2%3dBB">
!endblock

B<ASP-like Perl call:>

!block example; lang='Perl'
    $Tag->page(  { href => "dir/page",
                   arg  => "arguments", }  );
!endblock

or similarly with positional parameters,

!block example; lang='Perl'
    $Tag->page($href, $arg, $attribute_hash_reference);
!endblock

Using arrayref for joined search (see also {{CMD[jump="#attr_array_hash"]Attribute Arrays and Hashes}})

!block example
    my $searchref = [ "se=hammer/fi=products/sf=description",
                      "se=plutonium/fi=products/sf=description", ];

    $Tag->page( { href   => 'scan',
                  search => $searchref, } );
!endblock


H4: See Also

{{CMD[jump="#area"]area}}
 

H3: Description


The C<page> tag inserts a hyperlink to the specified Interchange page
or action. For example, [C<page> shirts] will expand into
!block example
   <aE<nbspace>href="http://[[EXAMPLE_DOMAIN]]/cgi-bin/[[EXAMPLE_CATALOG]]/shirts?mv_session_id=[[EXAMPLE_SESSION]]&mv_pc=1">
!endblock
The catalog page displayed will come from "shirts.html" in the pages
directory.

The additional argument will be passed to Interchange and placed in the
{arg} session parameter. This allows programming of a conditional page
display based on where the link came from. The argument is then available
with the tag [data session arg], or the embedded Perl session variable
$Session->{arg}. Spaces and some other characters
will be escaped with the %NN HTTP-style notation and unescaped when the
argument is read back into the session.

For better performance, Interchange can prebuild and cache pages that
would otherwise be generated dynamically. If Interchange has built
such a static page for the target, the C<page> tag produces a link to
the cached page whenever the user has accepted and sent back a cookie
with the session ID.  If the user did not accept the cookie,
Interchange cannot use the cache, since the link must then include the
I<mv_session_id> argument in order to preserve session.

H4: {{CMD[id="page_form"]form}}

The optional C<form> argument allows you to encode a form in the link.

!block example
        [page form="mv_order_item=[[EXAMPLE_SKU]]
                    mv_order_size=[[EXAMPLE_SIZE]]
                    mv_order_quantity=1
                    mv_separate_items=1
                    mv_todo=refresh"] Order [[EXAMPLE_SIZE]] [[EXAMPLE_PRODUCT]]</A>
!endblock

The two form values I<mv_session_id> and I<mv_arg> are automatically
added when appropriate.  The form value I<mv_arg> receives the value
of the tag's C<arg> parameter.

This would generate a form that ordered quantity one of item number
C<[[EXAMPLE_SKU]]> with size C<[[EXAMPLE_SIZE]]>.  The item would
appear on a separate line in the shopping cart, since
C<mv_separate_items> is set. Since the C<href> is not set, you will go
to the default shopping cart pageE<nbspace>E<emdash> alternatively,
you could have set C<mv_orderpage=yourpage> to go to C<yourpage>.

All normal Interchange form caveats applyE<nbspace>E<emdash> you must have an action,
you must supply a page if you don't want to go to the default,
etc.

You can theoretically submit any form with this, though none of the
included values can have newlines or trailing whitespace. If you want
to do something like that you will have to write a UserTag.

If the parameter C<href> is not supplied, I<process> is used, causing
normal Interchange form processing.

If the C<href> points to an http:// link, then no Interchange URL
processing will be done, but the URL will include mv_session_id,
mv_pc, and any arguments supplied with the C<arg> attribute:

!block example
       [page  href="http://www.elsewhere.net/cgi/script"
              form="cgi_1=ONE
                    cgi_2=TWO"
               arg="interchange argument"]External link</A>

       <A HREF="http://www.elsewhere.net/cgi/script?\
        mv_session_id=[[EXAMPLE_SESSION]]&mv_pc=1&mv_arg=interchange%20argument&\
        cgi_1=ONE&cgi_2=TWO">External link</A>
!endblock


H4: {{CMD[id="page_search"]search}}

Interchange allows you to pass a search in a URL. There are two ways
to do this:

^ Place the search specification in the named C<search> attribute.

** Interchange will ignore the C<href> parameter (the link will be set
to 'scan'.

** If you give the C<arg> parameter a value, that value will be
available as E<lbracket>{{C[jump="#value"]value}} mv_arg] within the
search display page.

+ Set the C<href> parameter to 'scan' and set C<arg> to the search
specification.

** Note that you can use this form positionallyE<nbspace>E<emdash> the
values go into C<href> and C<arg>, so you do not have to name
parameters.


These are identical:

!block example
   [page scan
         se=Impressionists
         sf=category]
      Impressionist Paintings
   [/page]

   [page href=scan
          arg="se=Impressionists
               sf=category"]
      Impressionist Paintings
   </A>

   [page search="se=Impressionists
                 sf=category"]
      Impressionist Paintings
   [/page]

!endblock

Here is the same thing from a non-interchange page (e.g., a home
page), assuming '/cgi-bin/[[EXAMPLE_CATALOG]]' is the CGI path to Interchange's vlink):

!block example
     <A HREF="/cgi-bin/[[EXAMPLE_CATALOG]]/scan/se=Impressionists/sf=category">
        Impressionist Paintings
     </A>
!endblock

Sometimes, you will find that you need to pass characters that
will not be interpreted positionally. In that case, you should
quote the arguments:

>    [page href=scan
>          arg=|
>                se="Something with spaces"
>          |]

The two-letter abbreviations are mapped with these letters:

>  DL  mv_raw_dict_look
>  MM  mv_more_matches
>  SE  mv_raw_searchspec
>  ac  mv_all_chars
>  ar  mv_arg
>  bd  mv_base_directory
>  bs  mv_begin_string
>  ck  mv_cache_key
>  co  mv_coordinate
>  cs  mv_case
>  cv  mv_verbatim_columns
>  de  mv_dict_end
>  df  mv_dict_fold
>  di  mv_dict_limit
>  dl  mv_dict_look
>  do  mv_dict_order
>  dp  mv_delay_page
>  dr  mv_record_delim
>  em  mv_exact_match
>  er  mv_spelling_errors
>  fi  mv_search_file
>  fm  mv_first_match
>  fn  mv_field_names
>  hs  mv_head_skip
>  id  mv_session_id
>  il  mv_index_delim
>  ix  mv_index_delim
>  lb  mv_search_label
>  lo  mv_list_only
>  lr  mv_line_return
>  lr  mv_search_line_return
>  ml  mv_matchlimit
>  mm  mv_max_matches
>  mp  mv_profile
>  ms  mv_min_string
>  ne  mv_negate
>  np  mv_nextpage
>  nu  mv_numeric
>  op  mv_column_op
>  os  mv_orsearch
>  pc  mv_pc
>  ra  mv_return_all
>  rd  mv_return_delim
>  rf  mv_return_fields
>  rg  mv_range_alpha
>  rl  mv_range_look
>  rm  mv_range_min
>  rn  mv_return_file_name
>  rr  mv_return_reference
>  rs  mv_return_spec
>  rx  mv_range_max
>  se  mv_searchspec
>  sf  mv_search_field
>  si  mv_search_immediate
>  sp  mv_search_page
>  sq  mv_sql_query
>  st  mv_searchtype
>  su  mv_substring_match
>  tf  mv_sort_field
>  to  mv_sort_option
>  un  mv_unique
>  va  mv_value


They can be treated just the same as form variables on the
page, except that they can't contain spaces, '/' in a file
name, or quote marks. These characters can be used
in URL hex encoding, i.e. %20 is a space, %2F is a
C</>, etc. -- C<&sp;> or C<&#32;> will not be recognized.
If you use one of the methods below to escape these "unsafe"
characters, you won't have to worry about this.

You may specify a one-click search in three different ways. The first is as
used in previous versions, with the scan URL being specified completely as the
page name.  The second two use the "argument" parameter to the C<[page ...]> or
E<lbracket>{{C[jump="#area"]area}} ...]> tags to specify the search
(an argument to a scan is never valid anyway).



H4: Original syntax

If you wish to do an OR search on the fields category and artist
for the strings "Surreal" and "Gogh", while matching substrings,
you would do:

> [page scan se=Surreal/se=Gogh/os=yes/su=yes/sf=artist/sf=category]
>    Van Gogh -- compare to surrealists
> [/page]

In this method of specification, to replace a / (slash) in a file name
(for the sp, bd, or fi parameter) you must use the shorthand of ::,
i.e. sp=results::standard. (This may not work for some browsers, so you
should probably either put the page in the main pages directory or define
the page in a search profile.)

H4: Ampersand syntax

You can substitute & for / in the specification and be able to use / and
quotes and spaces in the specification.

> [page scan se="Van Gogh"&sp=lists/surreal&os=yes&su=yes&sf=artist&sf=category]
>    Van Gogh -- compare to surrealists
> [/page]

Any "unsafe" characters will be escaped. 

H4: Multi-line syntax

You can specify parameters one to a line, as well. 

>    [page scan
>        se="Van Gogh"
>        sp=lists/surreal
>        os=yes
>        su=yes
>        sf=artist
>        sf=category
>    ] Van Gogh -- compare to surrealists [/page]

Any "unsafe" characters will be escaped. You may not search for trailing
spaces in this method; it is allowed in the other notations.



H4: Joined searches

You can also specify a joined search using an attribute array (see
N<{{CMD[jump="#attr_array_hash"]Attribute Arrays and Hashes}}):>

!block example
    E<lbracket>page href=scan
      search.0="se=fragrant
                fi=products
                sf=smell"
      search.1="se=purple
                sf=color"
      search.2="se=perennial
                sf=type"]
!endblock

The search routine called by the page tag automatically adds the other
relevant search specification elements, including the 'co=yes' to
indicate a combined search
({{CMD[jump="icdatabase.html#Coordinated and Joined Searching"]joinedE<nbspace>searches}}
are described in the Interchange database documentation).


H4: E<lbracket>/page]

This is not an actual end tag, but simply a macro that expands to
</A>. The following two lines are equivalent:

>  [page shirts]Our shirt collection[/page]
>  [page shirts]Our shirt collection</A>

\Tip: In large pages, just use the </A> tag for a small performance improvement.



H2: perl


H3: Summary

\Parameters: B<tables>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [perl] FOO [/perl].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->perl(
>        {
>         tables => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->perl($tables, $ATTRHASH, $BODY);

Attribute aliases

>            table ==> tables


 

H3: Description


>    [perl]
>        $name    = $Values->{name};
>        $browser = $Session->{browser};
>        return "Hi, $name! How do you like your $browser?
>    [/perl]

HTML example:

>    <PRE mv=perl>
>        $name    = $Values->{name};
>        $browser = $Session->{browser};
>        return "Hi, $name! How do you like your $browser?
>    </PRE>

Perl code can be directly embedded in Interchange pages. The code
is specified as [perl arguments*] any_legal_perl_code [/perl]. The
value returned by the code will be inserted on the page.

Object references are available for most Interchange tags and 
functions, as well as direct references to Interchange session and
configuration values.

>  $CGI->{key}               Hash reference to raw submitted values
>  $CGI_array->{key}         Arrays of submitted values
>  $Carts->{cartname}        Direct reference to shopping carts
>  $Config->{key}            Direct reference to $Vend::Cfg
>  $DbSearch->array(@args)   Do a DB search and get results
>  $Document->header()       Writes header lines
>  $Document->send()         Writes to output
>  $Document->write()        Writes to page
>  $Scratch->{key}           Direct reference to scratch area
>  $Session->{key}           Direct reference to session area
>  $Tag->tagname(@args)      Call a tag as a routine (UserTag too!)
>  $TextSearch->array(@args) Do a text search and get results
>  $Values->{key}            Direct reference to user form values
>  $Variable->{key}          Config variables (same as $Config->{Variable});
>  &HTML($html)              Same as $Document->write($html);
>  &Log($msg)                Log to the error log

For full descriptions of these objects, see I<Interchange Programming>.

If you wish to use database values in your Perl code, you must
pre-open the table(s) you will be using. This can be done by including
the table name in the C<tables> parameter of the Perl tag:

>    [perl tables=products]
>        $result = "You asked about $Values->{code}. Here is the description: ";
>        $result .= $Tag->data('products', 'description', $Values->{code});
>        return $result;
>    [/perl]

If you do not do this, your code will fail with a runtime Safe
error.





H2: price


H3: Summary

\Parameters: B<code>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->price(
>        {
>         code => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->price($code, $ATTRHASH);

Attribute aliases

>            base ==> mv_ib


 

H3: Description


\Arguments:

>        code       Product code/SKU
>        base       Only search in product table *base*
>        quantity   Price for a quantity
>        discount   If true(1), check discount coupons and apply
>        noformat   If true(1), don't apply currency formatting

Expands into the price of the product identified by code as found in
the products database. If there is more than one products file defined,
they will be searched in order unless constrained by the optional
argument B<base>. The optional argument B<quantity> selects an entry
from the quantity price list. To receive a raw number, with no currency
formatting, use the option C<noformat=1>.

Interchange maintains a price in its database for every product. The price
field is the one required field in the product databaseE<nbspace>E<emdash> it is necessary
to build the price routines.

For speed, Interchange builds the code that is used to determine a product's
price at catalog configuration time. If you choose to change a directive
that affects product pricing you must reconfigure the catalog.

Quantity price breaks are configured by means of the I<CommonAdjust>
directive. There are a number of CommonAdjust recipes which can be
used; the standard example in the demo calls for a separate pricing
table called C<pricing>. Observe the following:

>   CommonAdjust  pricing:q2,q5,q10,q25, ;products:price, ==size:pricing

This says to check quantity and find the applicable
column in the pricing database and apply it. In this case, it would be:

>    2-4      Column *q2*
>    5-9      Column *q5*
>    10-24    Column *q10*
>    25 up    Column *q25*

What happens if quantity is one? It "falls back" to the price that
is in the table C<products>, column C<price>.

After that, if there is a size attribute for the product, the column
in the pricing database corresponding to that column is checked for
additions or subtractions (or even percentage changes).

If you use this tag in the demo:

>    [price code=99-102 quantity=10 size=XL]

the price will be according to the C<q10> column, adjusted by what is in
the XL column. (The row is of course 99-102.) The following entry in
pricing:

>  code    q2   q5   q10  q25  XL
>  99-102  10   9    8    7    .50

Would yield 8.50 for the price. Quantity of 10 in the C<q10> column,
with 50 cents added for extra large (XL).

Following are several examples based on the above entry
as well as this the entry in the C<products> table:

>  code    description   price    size
>  99-102  T-Shirt       10.00    S=Small, M=Medium, L=Large*, XL=Extra Large

\NOTE: The examples below assume a US locale with 2 decimal places, use
of commas to separate, and a dollar sign ($) as the currency formatting.

>  TAG                                             DISPLAYS
>  ----------------------------------             ---------------------------
>  [price 99-102]                                  $10.00
>  [price code="99-102"]                           $10.00
>  [price code="99-102" quantity=1]                $10.00
>  [price code="99-102" noformat=1]                10
>  [price code="99-102" quantity=5]                $9.00
>  [price code="99-102" quantity=5 size=XL]        $9.50
>  [price code="99-102" size=XL]                   $10.50
>  [price code="99-102" size=XL noformat=1]        10.5

Product discounts for specific products, all products, or the entire
order can be configured with the [discount ...] tag. Discounts are applied
on a per-user basisE<nbspace>E<emdash> you can gate the discount based on membership in a
club or other arbitrary means.

Adding [discount 99-102] $s * .9[/discount] deducts 10% from the
price at checkout, but the price tag will not show that unless you
add the discount=1 parameter.

>    [price code="99-102"]            -->   $10.00
>    [price code="99-102" discount=1] -->   $9.00

See I<Product Discounts>.





H2: process


H3: Summary

Aliases for tag

process_target

\Parameters: B<target secure>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->process(
>        {
>         target => VALUE,
>         secure => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->process($target, $secure, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: profile


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->profile(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->profile($name, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: query


H3: Summary

\Parameters: B<sql>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [query] FOO [/query].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->query(
>        {
>         sql => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->query($sql, $ATTRHASH, $BODY);

Attribute aliases

>            query ==> sql


 

H3: Description

B<NO Description>




H2: read_cookie


H3: Summary

\Parameters: B<name>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->read_cookie(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->read_cookie($name);

 

H3: Description

B<NO Description>




H2: record


H3: Summary

No parameters.

B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->record(
>        {
>        }
>    )
>
> OR
>
>    $Tag->record($ATTRHASH);

Attribute aliases

>            code ==> key
>            column ==> col
>            field ==> col


 

H3: Description

B<NO Description>




H2: region


H3: Summary

No parameters.

B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [region] FOO [/region].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->region(
>        {
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->region($ATTRHASH, $BODY);

Attribute aliases

>            args ==> arg
>            params ==> arg
>            search ==> arg


 

H3: Description

B<NO Description>




H2: row


H3: Summary

\Parameters: B<width>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Interpolates B<container text> by default>.

This is a container tag, i.e. [row] FOO [/row].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->row(
>        {
>         width => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->row($width, $BODY);

 

H3: Description


Formats text in tables. Intended for use in emailed reports or <PRE></PRE> HTML
areas. The parameter I<nn> gives the number of columns to use. Inside the
row tag, [col param=value ...] tags may be used. 


H4: E<lbracket>col width=nn wrap=yes|no gutter=n align=left|right|input spacing=n]

Sets up a column for use in a [row]. This parameter can only be contained
inside a [row nn] [/row] tag pair. Any number of columns (that fit within
the size of the row) can be defined.

The parameters are:

>    width=nn        The column width, I<including the gutter>. Must be
>                    supplied, there is no default. A shorthand method
>                    is to just supply the number as the I<first> parameter,
>                    as in [col 20].
>
>    gutter=n        The number of spaces used to separate the column (on
>                    the right-hand side) from the next. Default is 2.
>
>    spacing=n       The line spacing used for wrapped text. Default is 1,
>                    or single-spaced.
>
>    wrap=(yes|no)   Determines whether text that is greater in length than
>                    the column width will be wrapped to the next line. Default
>                    is I<yes>.
>
>    align=(L|R|I)   Determines whether text is aligned to the left (the default),
>                    the right, or in a way that might display an HTML text
>                    input field correctly.

H4: E<lbracket>/col]

Terminates the column field.






H2: salestax


H3: Summary

\Parameters: B<name noformat>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->salestax(
>        {
>         name => VALUE,
>         noformat => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->salestax($name, $noformat);

Attribute aliases

>            cart ==> name


 

H3: Description


Expands into the sales tax on the subtotal of all the items ordered so
far for the cart, default cart is C<main>. If there is no key field to
derive the proper percentage, such as state or zip code, it is set to
0. If the noformat tag is present and non-zero, the raw number with no
currency formatting will be given.





H2: scratch


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->scratch(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->scratch($name);

 

H3: Description


Returns the contents of a scratch variable to the page. (A scratch
variable is set with a [set] value [/set] container pair.)





H2: scratchd


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->scratchd(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->scratchd($name);

 

H3: Description

B<NO Description>




H2: search_list

Formats results returned by a search.  Must be enclosed within a
{{C[jump="#search_region"]search_region}}.  Has sub-tags (see
{{C[jump="#subtags"]LoopingE<nbspace>tagsE<nbspace>andE<nbspace>Sub-tags}}). 

H2: search_region


H3: Summary

\Parameters: B<arg>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [search_region] FOO [/search_region].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->search_region(
>        {
>         arg => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->search_region($arg, $ATTRHASH, $BODY);

Attribute aliases

>            args ==> arg
>            params ==> arg
>            search ==> arg


 

H3: Description

B<NO Description>




H2: selected


H3: Summary

\Parameters: B<name value>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->selected(
>        {
>         name => VALUE,
>         value => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->selected($name, $value, $ATTRHASH);

 

H3: Description


You can provide a "memory" for drop-down menus, radio buttons, and
checkboxes with the [checked] and [selected] tags.

This will output SELECTED if the variable C<var_name> is equal to
C<value>. If the optional MULTIPLE argument is present, it will
look for any of a variety of values. Not case sensitive unless
the optional C<case=1> parameter is used.

Here is a drop-down menu that remembers an item-modifier
color selection:

>    <SELECT NAME="color">
>    <OPTION [selected color blue]> Blue
>    <OPTION [selected color green]> Green
>    <OPTION [selected color red]> Red
>    </SELECT>

Here is the same thing, but for a shopping-basket color
selection

>    <SELECT NAME="[modifier-name color]">
>    <OPTION [selected [modifier-name color] blue]> Blue
>    <OPTION [selected [modifier-name color] green]> Green
>    <OPTION [selected [modifier-name color] red]> Red
>    </SELECT>

By default, the Values space (i.e. [value foo]) is checkedE<nbspace>E<emdash> if you
want to use the volatile CGI space (i.e. [cgi foo]) use the option
C<cgi=1>.





H2: set


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [set] FOO [/set].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->set(
>        {
>         name => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->set($name, $BODY);

 

H3: Description


Sets a scratch variable to I<value>.

Most of the mv_* variables that are used for search and order conditionals are
in another namespaceE<nbspace>E<emdash> they can be set by means of hidden fields in a
form.

You can set an order profile with:

>  [set checkout]
>  name=required
>  address=required
>  [/set]
>  <INPUT TYPE=hidden NAME=mv_order_profile VALUE="checkout">

A search profile would be set with:

>  [set substring_case]
>  mv_substring_match=yes
>  mv_case=yes
>  [/set]
>  <INPUT TYPE=hidden NAME=mv_profile VALUE="substring_case">

Any of these profile values can be set in the OrderProfile files
as well.





H2: set_cookie


H3: Summary

\Parameters: B<name value expire>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->set_cookie(
>        {
>         name => VALUE,
>         value => VALUE,
>         expire => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->set_cookie($name, $value, $expire);

 

H3: Description

B<NO Description>




H2: seti


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Interpolates B<container text> by default>.

This is a container tag, i.e. [seti] FOO [/seti].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->seti(
>        {
>         name => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->seti($name, $BODY);

 

H3: Description

B<NO Description>




H2: setlocale


H3: Summary

\Parameters: B<locale currency>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->setlocale(
>        {
>         locale => VALUE,
>         currency => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->setlocale($locale, $currency, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: shipping


H3: Summary

\Parameters: B<mode>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->shipping(
>        {
>         mode => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->shipping($mode, $ATTRHASH);

Attribute aliases

>            carts ==> cart
>            modes ==> mode
>            name ==> mode
>            tables ==> table


 

H3: Description


The shipping cost of the items in the basket via C<mode> -- the default
mode is the shipping mode currently selected in the C<mv_shipmode>
variable. See I<SHIPPING>.





H2: shipping_desc


H3: Summary

Aliases for tag

shipping_description

\Parameters: B<mode>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->shipping_desc(
>        {
>         mode => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->shipping_desc($mode);

 

H3: Description

B<NO Description>




H2: soap


H3: Summary

\Parameters: B<call uri proxy>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->soap(
>        {
>         call => VALUE,
>         uri => VALUE,
>         proxy => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->soap($call, $uri, $proxy, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: sql


H3: Summary

\Parameters: B<type query>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [sql] FOO [/sql].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->sql(
>        {
>         type => VALUE,
>         query => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->sql($type, $query, $ATTRHASH, $BODY);

 

H3: Description

B<NO Description>




H2: strip


H3: Summary

No parameters.

Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [strip] FOO [/strip].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->strip(
>        {
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->strip($BODY);

 

H3: Description

B<NO Description>




H2: subtotal


H3: Summary

\Parameters: B<name noformat>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->subtotal(
>        {
>         name => VALUE,
>         noformat => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->subtotal($name, $noformat);

Attribute aliases

>            cart ==> name


 

H3: Description


\Positional: [subtotal cart* noformat*]

mandatory: NONE

optional: cart noformat

Expands into the subtotal cost, exclusive of sales tax, of
all the items ordered so far for the optional C<cart>. If the noformat
tag is present and non-zero, the raw number with no currency formatting
will be given.





H2: tag


H3: Summary

\Parameters: B<op arg>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [tag] FOO [/tag].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->tag(
>        {
>         op => VALUE,
>         arg => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->tag($op, $arg, $ATTRHASH, $BODY);

Attribute aliases

>            description ==> arg


 

H3: Description


Performs any of a number of operations, based on the presence of C<arg>.
The arguments that may be given are:


H4: export database file* type*

Exports a complete Interchange database to its text source file (or any
specified file). The integer C<n>, if specified, will select export in
one of the enumerated Interchange export formats. The following tag will
export the products database to products.txt (or whatever you have
defined its source file as), in the format specified by the
I<Database> directive:

>    [tag export products][/tag]

Same thing, except to the file products/new_products.txt:

>    [tag export products products/newproducts.txt][/tag]

Same thing, except the export is done with a PIPE delimiter:

>    [tag export products products/newproducts.txt 5][/tag]

The file is relative to the catalog directory, and only may be
an absolute path name if I<NoAbsolute> is set to C<No>.

H4: flag arg

Sets an Interchange condition.

The following enables writes on the C<products> and C<sizes> databases
held in Interchange internal DBM format:

>    [tag flag write]products sizes[/tag]

SQL databases are always writable if allowed by the SQL database itselfE<nbspace>E<emdash>
in-memory databases will never be written.

The [tag flag build][/tag] combination forces static build of a page, even
if dynamic elements are contained. Similarly, the [tag flag cache][/tag]
forces search or page caching (not usually wise).

H4: log dir/file

Logs a message to a file, fully interpolated for Interchange tags.
The following tag will send every item code and description in the user's
shopping cart to the file logs/transactions.txt:

>    [tag log logs/transactions.txt]
>    [item_list][item-code]  [item-description]
>    [/item_list][/tag]

The file is relative to the catalog directory, and only may be
an absolute path name if I<NoAbsolute> is set to C<No>.

H4: mime description_string

Returns a MIME-encapsulated message with the boundary as employed
in the other mime tags, and the C<description_string> used as the 
Content-Description. For example

>   [tag mime My Plain Text]Your message here.[/tag]

will return

>  Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
>  Content-ID: [sequential, lead as in mime boundary]
>  Content-Description: My Plain Text
>
>  Your message here.

When used in concert with [tag mime boundary], [tag mime header], and
\[tag mime id], allows MIME attachments to be includedE<nbspace>E<emdash> typically with
PGP-encrypted credit card numbers. See the demo page ord/report.html
for an example.

H4: mime boundary

Returns a MIME message boundary with unique string keyed on
session ID, page count, and time.

H4: mime header

Returns a MIME message header with the proper boundary for that
session ID, page count, and time.

H4: mime id

Returns a MIME message id with the proper boundary for that
session ID, page count, and time.

H4: show_tags

The encased text will not be substituted for with Interchange tags, 
with < and [ characters changed to C<&>#lt; and C<&>#91; respectively.

>    [tag show_tags][value whatever][/tag]

H4: time

Formats the current time according to POSIX strftime arguments.
The following is the string for Thursday, April 30, 1997.

>    [tag time]%A, %B %d, %Y[/tag]

H4: touch 

Touches a database to allow use of the tag_data() routine in 
user-defined subroutines.  If this is not done, the routine
will error out if the database has not previously been accessed
on the page.

>    [tag touch products][/tag]






H2: time


H3: Summary

\Parameters: B<locale>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [time] FOO [/time].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->time(
>        {
>         locale => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->time($locale, $ATTRHASH, $BODY);

 

H3: Description

Formats the current time according to POSIX strftime arguments.
The following is the string for Monday, January 1, 2001.

>    [time]%A, %B %d, %Y[/tag]

See the C<strftime> man page for information on the arguments (which are
the same as modern UNIX date commands).

Accepts the following options:


H4: adjust

If you wish to temporarily adjust the time for display purposes, you can
pass an C<adjust> parameter with the number of hours (plus or minus) from
the local time or from GMT:

>        [time]%c[/time]
>        [time adjust="-3"]%c[/time]

Will display:

> Mon 01 Jan 2001 11:29:03 AM EST
> Mon 01 Jan 2001 08:29:03 AM EST

Note that the time zone does not changeE<nbspace>E<emdash> you should either pick a format
which doesn't display zone, use the C<tz> parameter, or manage it yourself.

\NOTE: You can adjust time globally for an Interchange installation by
setting the $ENV{TZ} variable on many systems. Set TZ in your environment
and then restart interchange:

>        ## bash/ksh/sh
>        TZ=PST7PDT; export TZ
>        interchange -restart
>
>        ## csh/tcsh
>        setenv TZ PST7PDT
>        interchange -restart

On most modern UNIX systems, all times will now be in the PST zone.

H4: gmt

If you want to display time as GMT, use the C<gmt> parameter:

>        [time]%c[/time]
>        [time gmt=1]%c[/time]

will display:

>        Mon 01 Jan 2001 11:33:26 AM EST
>        Mon 01 Jan 2001 04:33:26 PM EST

Once again, the zone will not be set to GMT, so you should pick a format
string which doesn't use zone, use the C<tz> parameter, or manage it yourself.

H4: locale

Format the time according to the named C<locale>, assuming that locale is
available on your operating system. For example, the following:

>        [time locale=en_US]%B %d, %Y[/time]
>        [time locale=fr_FR]%B %d, %Y[/time]

should display:

>        January 01, 2001
>        janvier 01, 2001

H4: tz

Use the passed C<tz> to display the time. Will adjust for hours difference.

\Example:

>        [time tz=GMT0]
>        [time tz=CST6CDT]
>        [time tz=PST8PDT]

will display:

>        Mon 01 Jan 2001 04:43:02 PM GMT
>        Mon 01 Jan 2001 10:43:02 AM CST
>        Mon 01 Jan 2001 08:43:02 AM PST

Note that the first alphabetical string is the zone name when not under daylight
savings time, the digit is the number of hours displacement from GMT, and
the second alphabetical string is the zone name when in daylight savings
time. NOTE: This may not work on all operating systems.






H2: timed_build


H3: Summary

\Parameters: B<file>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [timed_build] FOO [/timed_build].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->timed_build(
>        {
>         file => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->timed_build($file, $ATTRHASH, $BODY);

 

H3: Description


Allows you to build CPU-intensive regions of ITL tags on a timed basis.

In the simplest case, surround a region of ITL with E<lbracket>{{C[jump="#timed_build"]timed-build}}E<rbracket>
and C<[/timed-build]>:

>        [timed-build]
>                Built at [time]%c[/time].
>        [/timed-build]

If a C<file> parameter is not passed, saves to the directory I<timed> in
catalog root, with the file name of the current page. If the C<minutes>
parameter is not passed specifying how often the page should be rebuilt,
then it will not be rebuilt until the output file is removed.

Accepts the following parameters:


H4: file

Name of the file to save the results in. Relative to catalog root.
The directory must exist.

H4: if

Allows you to to only display the cached region when the C<if> paremeter
is true. For example, you can do:

>        [timed-build if="[value timed]"]
>        ITL tags....
>        [/timed-build]

The cached region will only be displayed if the variable C<timed> is set
to a non-zero, non-blank value. Otherwise, the ITL tags will be re-interpreted
every time.

H4: minutes

The number of minutes after which the timed build should be repeated.
If set to 0, it will be built once and then not rebuilt until the output
file is removed.

H4: period

Alternative way of expressing time. You can pass a string describing
the rebuild time period:

>        [timed-build period="4 hours"] 
>        ITL tags....
>        [/timed-build]

This is really the same as C<minutes=240>. Useful for passing seconds:

>        [timed-build period="5 seconds"] 
>        ITL tags....
>        [/timed-build]

The region will be rebuilt every 5 seconds.

Performance N<Tip:> use minutes
of .08 instead; avoids having to parse the period string.


If you have the StaticDir catalog.cfg parameter set to a writable path,
you can build a cached static version of your catalog over time. Simply
place a [timed-build] tag at the top of pages you wish to build statically.
Assuming the catalog is not busy and write lock can be obtained, the
StaticDBM database will be updated to mark the page as static and the
next time a link is made for that page the static version will be presented.





H2: tmp


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Interpolates B<container text> by default>.

This is a container tag, i.e. [tmp] FOO [/tmp].
\Nesting: NO

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->tmp(
>        {
>         name => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->tmp($name, $BODY);

 

H3: Description


Sets a scratch variable to I<value>, but at the end of the user session the
Scratch key is deleted. This saves session write time in many cases.

This tag interpolates automatically. (Interpolation
can be turned off with C<interpolate=0>.)

IMPORTANT NOTE: the [tmp ...][/tmp] tag is not appropriate for setting
order profiles or C<mv_click> actions. If you want to avoid that, use
a profile stored via the catalog.cfg directive C<OrderProfile>.





H2: total_cost


H3: Summary

\Parameters: B<name noformat>

Positional parameters in same order.


Pass attribute hash as last to subroutine: B<no>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->total_cost(
>        {
>         name => VALUE,
>         noformat => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->total_cost($name, $noformat);

Attribute aliases

>            cart ==> name


 

H3: Description


Expands into the total cost of all the items in the current shopping cart,
including sales tax (if any).





H2: tree


H3: Summary

\Parameters: B<table master subordinate start>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [tree] FOO [/tree].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->tree(
>        {
>         table => VALUE,
>         master => VALUE,
>         subordinate => VALUE,
>         start => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->tree($table, $master, $subordinate, $start, $ATTRHASH, $BODY);

Attribute aliases

>            sub ==> subordinate


 

H3: Description

Provides iterative list capability for binary trees.  It produces
hash-based rows use the same tags as E<lbracket>{{C[jump="#item_list"]item-list}}E<rbracket>; sets some additional
hash key entries to describe the tree and provide display control.

Works on a data set with the structure:

>    parent  child
>    99      a
>    a       b
>    a       c
>    a       d
>    a       x
>    x       y
>    x       z
>    99      m
>    99      n
>    99      o
>    o       e
>    o       f
>    o       g

Sets several keys which assist in walking and displaying the
tree.


H4: mv_level

Level of the item. If it is in the first level, it is 0.  Sublevels are
infinite (except for performance).

H4: mv_increment

Increment label for the item. Normally goes from 1...n, but can be changed to
A...Z or a...z in outline mode.

H4: mv_children

If in autodetect mode, set to the number of children this branch has. If a
leaf, set to 0.

H4: mv_spacing

A multiple of level times the spacing option. Useful for setting width of
spacer images.

The above sample data would produce:

>    a           mv_level=0, mv_increment=1, mv_children=4
>        b       mv_level=1, mv_increment=1, mv_children=0
>        c       mv_level=1, mv_increment=2, mv_children=0
>        d       mv_level=1, mv_increment=3, mv_children=0
>        x       mv_level=1, mv_increment=4, mv_children=2
>            y   mv_level=2, mv_increment=1, mv_children=0
>            z   mv_level=2, mv_increment=2, mv_children=0
>    m           mv_level=0, mv_increment=1, mv_children=0
>    n           mv_level=0, mv_increment=2, mv_children=0
>    o           mv_level=0, mv_increment=3, mv_children=3
>        e       mv_level=1, mv_increment=1, mv_children=0
>        f       mv_level=1, mv_increment=2, mv_children=0
>        g       mv_level=1, mv_increment=3, mv_children=0

from the tag call:

>        <table>
>    [tree   start=99
>            parent=parent_fld
>            child=child_fld
>            autodetect=1
>                        spacing=4
>            full=1]
>        <tr>
>        <td>
>        [if-item-param mv_level]
>                [item-calc]
>                        return '&nbsp' x [item-param mv_spacing];
>                [/item-calc]
>        [/if-item-param]
>        [item-param child_fld]
>        </td>
>        <td>
>                mv_level=[item-param mv_level],
>                mv_increment=[item-param mv_increment],
>                mv_children=[item-param mv_children]
>        </td>
>        </tr>
>        [/tree]
>        </table>

Accepts the following paremeters:


H4: table

Database table which contains the tree. Must be a valid Interchange
table identifier.

H4: parent

The column which is used to determine the parent of the item.

H4: subordinate

The child column, which determines which items are sub-items of
the current one. Used to re-query for items with its value in
C<parent>.

H4: start_item

The first item to be followed, i.e. the C<parent> value of all the top-level
items.

H4: autodetect

Specifies that the next level should be followed to detect the number
of child items contained. Not recursive; only follows far enough to
determine the children of the current item.

H4: full

Specifies that all items should be followed. Essentially the same as
specifying C<memo> and passing the C<explode> variable, but not dependent
on them. Useful for building lists for inclusion in embedded Perl, among
other things.

H4: stop

An optional C<stop> field which, when the value is true, can stop the
following of the branch.

H4: continue

An optional C<continue> field which, when the value is true, can force
the branch to be followed.

H4: sort

The column which should be used for ordering the itemsE<nbspace>E<emdash> determines the
order in which they will be displayed under the current parent.

H4: outline

Sets outline mode, where C<mv_increment> will be displayed with
letter values or numeral values. If set to specifically C<1>, will
produced outline increments like:

>    1
>        A
>        B
>            1
>            2
>        C
>            1 
>            2
>                a
>                b
>                    1
>                    2
>                        a
>                        b
>    2

H4: memo

Indicates that the collapse/explode/toggle features are to be used, and
names a C<Scratch> variable where the values should be stored.

H4: collapse

The name of a variable in the user's session which will determine that the
tree should be "collapsed". When collapsed, the child items will not be 
followed unless they are set to be followed with C<toggle>. Zeros all
toggles.

Requires C<memo> to be set if values are to be retained.

H4: toggle

The name of a variable in the user's session which will determine that the
current item should be either followed or not followed. The first time the
C<toggle> variable corresponding to its primary key is passed, the item will
be expanded. The next call will "collapse" the item.

Requires C<memo> to be set if values are to be retained.

H4: explode

The name of a variable in the user's session which will determine that the
tree should be "exploded". When exploded, all child items are followed and 
the full tree can be displayed.

Requires C<memo> to be set if values are to be retained.

H4: pedantic

When set to a true value, and an endless tree is detected (i.e. the
child branch contains a parent) then the error will be logged to the
catalog error log and the tree call will return with an error.

If C<pedantic> is not set (the default), the current leaf will be shown
but never followed. This allows partial display of the tree.

H4: log_error

When set to a true value, and an endless tree is detected (i.e. the
child branch contains a parent) then the error will be logged to the
catalog error log. No logging done by default.

H4: show_error

When set to a true value, and an endless tree is detected (i.e. the
child branch contains a parent) then the error will be returned in the
page.  Errors are NOT shown by default.


In addition to the above values, all valid options for a list tag are
in force. For example, you can set a "SELECTED" value on an option list
with C<option=1>, set the tag prefix with C<prefix>, etc.





H2: try


H3: Summary

\Parameters: B<label>

Positional parameters in same order.


B<The attribute hash reference is passed> after the parameters but before
the container text argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

This is a container tag, i.e. [try] FOO [/try].
\Nesting: NO

Invalidates cache: B<no>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->try(
>        {
>         label => VALUE,
>        },
>        BODY
>    )
>
> OR
>
>    $Tag->try($label, $ATTRHASH, $BODY);

 

H3: Description

B<NO Description>




H2: update


H3: Summary

\Parameters: B<function>

ONLY THE B<> PARAMETERS ARE POSITIONAL.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->update(
>        {
>         function => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->update($function, $ATTRHASH);

 

H3: Description

B<NO Description>




H2: userdb


H3: Summary

\Parameters: B<function>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->userdb(
>        {
>         function => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->userdb($function, $ATTRHASH);

Attribute aliases

>            name ==> nickname
>            table ==> db


 

H3: Description


Interchange provides a C<[userdb ...]> tag to access the UserDB functions.

> [userdb
>        function=function_name
>        username="username"*
>        password="password"*
>        verify="password"*
>        oldpass="old password"*
>        shipping="fields for shipping save"
>        billing="fields for billing save"
>        preferences="fields for preferences save"
>        force_lower=1
>        param1=value*
>        param2=value*
>        ...
>        ]

\* Optional

It is normally called in an C<mv_click> or C<mv_check> setting, as in:

>    [set Login]
>    mv_todo=return
>    mv_nextpage=welcome
>    [userdb function=login]
>    [/set]
>
>    <FORM ACTION="[process-target]" METHOD=POST>
>    <INPUT TYPE=hidden NAME=mv_click VALUE=Login>
>    Username <INPUT NAME=mv_username SIZE=10>
>    Password <INPUT NAME=mv_password SIZE=10>
>    </FORM>

There are several global parameters that apply to any use of
the C<userdb> functions. Most importantly, by default the database
table is set to be I<userdb>. If you must use another table name,
then you should include a C<database=table> parameter with any
call to C<userdb>. The global parameters (default in parens):

>    database     Sets user database table (userdb)
>    show         Show the return value of certain functions
>                 or the error message, if any (0)
>    force_lower  Force possibly upper-case database fields
>                 to lower case session variable names (0)
>    billing      Set the billing fields (see Accounts)
>    shipping     Set the shipping fields (see Address Book)
>    preferences  Set the preferences fields (see Preferences)
>    bill_field   Set field name for accounts (accounts)
>    addr_field   Set field name for address book (address_book)
>    pref_field   Set field name for preferences (preferences)
>    cart_field   Set field name for cart storage (carts)
>    pass_field   Set field name for password (password)
>    time_field   Set field for storing last login time (time)
>    expire_field Set field for expiration date (expire_date)
>    acl          Set field for simple access control storage (acl)
>    file_acl     Set field for file access control storage (file_acl)
>    db_acl       Set field for database access control storage (db_acl)





H2: value


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->value(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->value($name, $ATTRHASH);

 

H3: Description


HTML examples:

>   <PARAM MV="value name">
>   <INPUT TYPE="text" NAME="name" VALUE="[value name]">

Expands into the current value of the customer/form input field named
by field. If C<flag> is present, single quotes will be escaped with a
backslash; this allows you to contain the C<[value ...]> tag within
single quotes. (It is somewhat better to use other quoting methods.)
When the value is returned, any Interchange tags present in the value will
be escaped. This prevents users from entering Interchange tags in form values,
which would be a serious security risk.

If the C<set> value is present, the form variable value will be set
to it and the empty string returned. Use this to "uncheck" a checkbox
or set other form variable values to defaults. B<NOTE:> This is only
available in new-style tags, for safety reasons.





H2: value_extended


H3: Summary

\Parameters: B<name>

Positional parameters in same order.


B<The attribute hash reference is passed> to the subroutine after
the parameters as the last argument.
B<This may mean that there are parameters not shown here.>

Must pass named parameter interpolate=1 to cause interpolation.

Invalidates cache: B<YES>

Called Routine: 

B<ASP-like Perl call:>

>    $Tag->value_extended(
>        {
>         name => VALUE,
>        }
>    )
>
> OR
>
>    $Tag->value_extended($name, $ATTRHASH);

 

H3: Description


Named call example:

>   [value-extended 
>            name=formfield
>            outfile=filename*
>            ascii=1*
>            yes="Yes"*
>            no="No"*
>            joiner="char|string"*
>            test="isfile|length|defined"*
>            index="N|N..N|*"
>            file_contents=1*
>            elements=1*]

Expands into the current value of the customer/form input field named
by field. If there are multiple elements of that variable, it will return
the value at C<index>; by default all joined together with a space.

If the variable is a file variable coming from a multipart/form-data
file upload, then the contents of that upload can be returned to the 
page or optionally written to the C<outfile>.


H4: name

The form variable NAME. If no other parameters are present, then the 
value of the variable will be returned. If there are multiple elements,
then by default they will all be returned joined by a space. If C<joiner>
is present, then they will be joined by its value.

In the special case of a file upload, the value returned is the name
of the file as passed for upload.

H4: joiner

The character or string that will join the elements of the array. Will
accept string literals such as "\n" or "\r".

H4: test

Three testsE<nbspace>E<emdash> C<isfile> returns true if the variable is a file upload.
C<length> returns the length. C<defined> returns whether the value
has ever been set at all on a form.

H4: index

The index of the element to return if not all are wanted. This is
useful especially for pre-setting multiple search variables. If set
to C<*>, will return all (joined by C<joiner>). If a range, such
as C<0 .. 2>, will return multiple elements.

H4: file_contents

Returns the contents of a file upload if set to a non-blank, non-zero value.
If the variable is not a file, returns nothing.

H4: outfile

Names a file to write the contents of a file upload to. It will not
accept an absolute file name; the name must be relative to the catalog
directory. If you wish to write images or other files that would go to
HTML space, you must use the HTTP server's C<Alias> facilities or 
make a symbolic link.

H4: ascii

To do an auto-ASCII translation before writing the C<outfile>, set
the C<ascii> parameter to a non-blank, non-zero value. Default is no
translation.

H4: yes

The value that will be returned if a test is true or a file is
written successfully. Defaults to C<1> for tests and the empty
string for uploads.

H4: no

The value that will be returned if a test is false or a file write
fails. Defaults to the empty string.





H1: User-defined Tags

To define a tag that is catalog-specific, place I<UserTag> directives in
your catalog.cfg file. For server-wide tags, define them in interchange.cfg.
Catalog-specific tags take precedence if both are definedE<nbspace>E<emdash> in fact,
you can override the base Interchange tag set with them. The directive
takes the form:

>   UserTag  tagname  property  value

where C<tagname> is the name of the tag, C<property> is the attribute
(described below), and C<value> is the value of the property for that
tagname.

The user tags can either be based on Perl subroutines or just be
aliases for existing tags. Some quick examples are below.

An alias:

>    UserTag product_name Alias     data products title

This will change [product_name 99-102] into [data products title 99-102],
which will output the C<title> database field for product code C<99-102>.
Don't use this with C<[item-data ...]> and C<[item-field ...]>, as they
are parsed separately.  You can do C<[product-name [item-code]]>, though.

A simple subroutine:

>    UserTag company_name Routine   sub { "Your company name" }

When you place a [company-name] tag in an Interchange page, the text 
C<Your company name> will be substituted.

A subroutine with a passed text as an argument:

>    UserTag caps   Routine   sub { return "\U@_" }
>    UserTag caps   HasEndTag 

The tag [caps]This text should be all upper case[/caps] will become
C<THIS TEXT SHOULD BE ALL UPPER CASE>.

Here is a useful one you might wish to use:

>    UserTag quick_table HasEndTag
>    UserTag quick_table Interpolate
>    UserTag quick_table Order   border
>    UserTag quick_table Routine <<EOF
>    sub {
>        my ($border,$input) = @_;
>        $border = " BORDER=$border" if $border;
>        my $out = "<TABLE ALIGN=LEFT$border>";
>        my @rows = split /\n+/, $input;
>        my ($left, $right);
>        for(@rows) {
>            $out .= '<TR><TD ALIGN=RIGHT VALIGN=TOP>';
>            ($left, $right) = split /\s*:\s*/, $_, 2;
>            $out .= '<B>' unless $left =~ /</;
>            $out .= $left;
>            $out .= '</B>' unless $left =~ /</;
>            $out .= '</TD><TD VALIGN=TOP>';
>            $out .= $right;
>            $out .= '</TD></TR>';
>            $out .= "\n";
>        }
>        $out .= '</TABLE>';
>    }
>    EOF

Called with:

>    [quick-table border=2]
>    Name: [value name]
>    City: [value city][if value state], [value state][/if] [value country]
>    [/quick_table]

The properties for UserTag are are:


H2: Alias

An alias for an existing (or other user-defined) tag. It takes the
form:

>    UserTag tagname Alias    tag to insert

An Alias is the only property that does not require a I<Routine>
to process the tag.

H2: attrAlias

An alias for an existing attribute for defined tag. It takes the
form:

>    UserTag tagname attrAlias   alias attr

As an example, the standard Interchange C<value> tag takes a named
attribute of C<name> for the variable name, meaning that C<[value name=var]>
will display the value of form field C<var>. If you put this line
in catalog.cfg:

>    UserTag value attrAlias   identifier name

then C<[value identifier=var]> will be an equivalent tag.

H2: CanNest

Notifies Interchange that this tag must be checked for nesting.
Only applies to tags that have I<HasEndTag> defined, of course.
\NOTE: Your routine must handle the subtleties of nesting, so
don't use this unless you are quite conversant with parsing
routines.  See the routines C<tag_loop_list> and C<tag_if> in 
lib/Vend/Interpolate.pm for an example of a nesting tag.

>    UserTag tagname CanNest

H2: HasEndTag

Defines an ending [/tag] to encapsulate your textE<nbspace>E<emdash> the text in
between the beginning C<[tagname]> and ending C<[/tagname]> will
be the last argument sent to the defined subroutine.

>    UserTag tagname HasEndTag

H2: Implicit

This defines a tag as implicit, meaning it can just be an C<attribute> 
instead of an C<attribute=value> pair. It must be a recognized attribute
in the tag definition, or there will be big problems. Use this with caution!

>    UserTag tagname Implicit attribute value

If you want to set a standard include file to a fixed value by default,
but don't want to have to specify C<[include file="/long/path/to/file"]>
every time, you can just put:

>    UserTag include Implicit file file=/long/path/to/file

and C<[include file]> will be the equivalent. You can still specify
another value with C[include file="/another/path/to/file"]

H2: InsertHTML

This attribute makes HTML tag output be inserted into the containing
tag, in effect adding an attribute=value pair (or pairs).

>    UserTag tagname InsertHTML   htmltag  mvtag|mvtag2|mvtagN

In Interchange's standard tags, among others, the <OPTION ...> tag has the
\[selected ..] and [checked ...] tags included with them, so
that you can do:

>   <INPUT TYPE=checkbox
>        MV="checked mvshipmode upsg" NAME=mv_shipmode> UPS Ground shipping

to expand to this:

>   <INPUT TYPE=checkbox CHECKED NAME=mv_shipmode> UPS Ground shipping

Providing, of course, that C<mv_shipmode> B<is> equal to C<upsg>.
If you want to turn off this behavior on a per-tag basis, add the
attribute mv.noinsert=1 to the tag on your page.

H2: InsideHTML

To make a container tag be placed B<after> the containing
HTML tag, use the InsideHTML setting.

>    UserTag tagname InsideHTML   htmltag  mvtag|mvtag2|mvtagN

In Interchange's standard tags, the only InsideHTML tag is the
<SELECT> tag when used with I<loop>, which causes this:

>   <SELECT MV="loop upsg upsb upsr" NAME=mv_shipmode>
>   <OPTION VALUE="[loop-code]"> [shipping-desc [loop-code]]
>   </SELECT>

to expand to this:

>   <SELECT NAME=mv_shipmode>
>   [loop upsg upsb upsr]
>   <OPTION VALUE="[loop-code]"> [shipping-desc [loop-code]]
>   [/loop]
>   </SELECT>

Without the InsideHTML setting, the [loop ...] would have been B<outside>
of the selectE<nbspace>E<emdash> not what you want.  If you want to turn off this
behavior on a per-tag basis, add the attribute mv.noinside=1 to the tag
on your page.

H2: Interpolate

The behavior for this attribute depends on whether the tag is a container
(i.e. C<HasEndTag> is defined). If it is not a container, the C<Interpolate>
attribute causes the B<the resulting HTML> from the C<UserTag> to be
re-parsed for more Interchange tags.  If it is a container, C<Interpolate>
causes the contents of the tag to be parsed B<before> the tag routine
is run.

>    UserTag tagname Interpolate

H2: InvalidateCache

If this is defined, the presence of the tag on a page will prevent
search cache, page cache, and static builds from operating on the
page.

>    UserTag tagname InvalidateCache

It does not override [tag flag build][/tag], though.

H2: Order

The optional arguments that can be sent to the tag. This defines not only
the order in which they will be passed to I<Routine>, but the name of
the tags. If encapsulated text is appropriate (I<HasEndTag> is set),
it will be the last argument.

>    UserTag tagname Order param1 param2

H2: PosRoutine

Identical to the Routine argumentE<nbspace>E<emdash> a subroutine that will be called when
the new syntax is not used for the call, i.e. C<[usertag argument]> instead
of C<[usertag ARG=argument]>. If not defined, I<Routine> is used, and Interchange
will usually do the right thing.

H2: ReplaceAttr

Works in concert with InsertHTML, defining a B<single> attribute which
will be replaced in the insertion operation..

>  UserTag tagname ReplaceAttr  htmltag attr

An example is the standard HTML <A HREF=...> tag. If you want to use the
Interchange tag C<[area pagename]> inside of it, then you would normally
want to replace the HREF attribute. So the equivalent to the following
is defined within Interchange:

>  UserTag  area  ReplaceAttr  a  href

Causing this

>    <A MV="area pagename" HREF="a_test_page.html">

to become

>    <A HREF="http://yourserver/cgi/simple/pagename?X8sl2lly;;44">
 
when intepreted.
    
H2: ReplaceHTML

For HTML-style tag use only. Causes the tag containing the Interchange tag to
be stripped and the result of the tag to be inserted, for certain tags.
For example:

>  UserTag company_name Routine sub { my $l = shift; return "$l: XYZ Company" }
>  UserTag company_name HasEndTag
>  UserTag company_name ReplaceHTML  b    company_name

<BR> is the HTML tag, and "company_name" is the Interchange tag.
At that point, the usage:

>    <B MV="company-name"> Company </B>  --->>  Company: XYZ Company

Tags not in the list will not be stripped:

>    <I MV="company-name"> Company </I> --->>  <I>Company: XYZ Company</I>

H2: Routine

An inline subroutine that will be used to process the arguments of the tag. It
must not be named, and will be allowed to access unsafe elements only if
the C<interchange.cfg> parameter I<AllowGlobal> is set for the catalog.

>    UserTag tagname Routine  sub { "your perl code here!" }

The routine may use a "here" document for readability:

>    UserTag tagname Routine <<EOF
>    sub {
>        my ($param1, $param2, $text) = @_;
>        return "Parameter 1 is $param1, Parameter 2 is $param2";
>    }
>    EOF

The usual I<here documents> caveats apply.

Parameters defined with the I<Order> property will be sent to the routine
first, followed by any encapsulated text (I<HasEndTag> is set).


Note that the UserTag facility, combined with AllowGlobal, allows the
user to define tags just as powerful as the standard Interchange tags.
This is not recommended for the novice, thoughE<nbspace>E<emdash> keep it simple. 8-)


H1: Standard Usertags

The distribution includes a number of prebuilt usertags in the
C<interchange_root/usertag> directory.  Some of these are used by the
foundation catalog or its administrative interface.

H2: {{CMD[id="ut_bar_button"]bar_button}}


H2: {{CMD[id="ut_delete_cart"]delete_cart}}


H2: {{CMD[id="ut_fedex_query"]fedex_query}}


H2: {{CMD[id="ut_loc"]loc}}


H2: {{CMD[id="ut_reconfig_wait"]reconfig_wait}}


H2: {{CMD[id="ut_title_bar"]title_bar}}


H2: {{CMD[id="ut_xml_generator"]xml_generator}}


H2: {{CMD[id="ut_button"]button}}


H2: {{CMD[id="ut_email"]email}}


H2: {{CMD[id="ut_formel"]formel}}


H2: {{CMD[id="ut_rand"]rand}}


H2: {{CMD[id="ut_save_cart"]save_cart}}


H2: {{CMD[id="ut_ups_query"]ups_query}}


H2: {{CMD[id="ut_convert_date"]convert_date}}


H2: {{CMD[id="ut_email_raw"]email_raw}}


H2: {{CMD[id="ut_get_url"]get_url}}


H2: {{CMD[id="ut_reconfig"]reconfig}}


H2: {{CMD[id="ut_summary"]summary}}


H2: {{CMD[id="ut_usertrack"]usertrack}}


H2: {{CMD[id="ut_db_date"]db_date}}


H2: {{CMD[id="ut_fcounter"]fcounter}}


H2: {{CMD[id="ut_load_cart"]load_cart}}


H2: {{CMD[id="ut_reconfig_time"]reconfig_time}}


H2: {{CMD[id="ut_table_organize"]table_organize}}


H2: {{CMD[id="ut_var"]var}}


A1: Tag Entry Format

H2[notoc] dummy

N:Alias: B<pedagogy>, B<dummy_alias>
!block note;
E<lbracket>B<dummy>E<nbspace>...], [B<pedagogy>E<nbspace>...] and [B<dummy-alias>E<nbspace>...] are equivalent.
!endblock

A short description of the tag goes here.  This example (B<dummy>) is
not an actual tag.


A3: Summary

!block example;
    [B<dummy> first second I<other named attributes>][/dummy]
    [B<dummy> first=first_args second=second_args I<other named attributes>][/dummy]
!endblock

!block note; label="Positional parameters"
The first line shows the usage with positional parameters (given in
order). The second line shows usage with named parameters.
!endblock

#!block table; style="plain"; colvaligns="TTT"
!block table; colvaligns="TTT"
Parameters|Description|Default
first|<<
The first positional parameter
. I<Special arguments>
** '{{CMD[jump="#dummy_special_value"]special_value}}'E<nbspace>E<emdash>
any special arguments to the parameter that cause the tag to behave
differently are listed here and described in detail in the
B<Description> section below.
** 'pig_latin'E<nbspace>E<emdash> For this dummy tag, let's suppose
that an argument of 'pig_latin' rewrites the body text in pig latin.

>>|default value if the parameter is not given
second|Another example parameter|I<none>
I<alias1>|<<
alias for B<first>E<nbspace>E<emdash> some parameters have
aliasesE<nbspace>E<emdash> [dummyE<nbspace>alias1="X"] is equivalent
to [dummyE<nbspace>first="X"]
>>|Same default as B<first>, of course
!endblock

#!block table; style="plain"; colvaligns="TT"
!block table; colvaligns="TT"
Attributes|Default
{{CMD[jump="#dummy_more"]more}}|I<none>
{{CMD[jump="#dummy_still_more"]still-more}}|I<none> (requires B<more>)
{{CMD[jump="#dummy_other"]other}}|I<none>
{{CMD[jump="#attr_interpolate"]interpolate (body)}}|I<Yes>
{{CMD[jump="#attr_reparse"]reparse}}|I<No>
!endblock

#!block table; style="plain";headings=1
!block table;headings=1
A|B
Other_Charactreristics|
Invalidates {{CMD[jump="#static_cache"]cache}}|I<No>
{{CMD[jump="#macro_tags"]Macro}}|I<No>
Has end tag|[/dummy]
!endblock

B<Tag expansion example:>

!block example
   [dummy first=pig_latin second="Capitalize"]\
   Body text acted on by the tag goes here.[/dummy]
---
   OdyBay ExtTaY acted on YBay EThay AgTay OesGay \
   EreHay.
!endblock

!block note; label="Reading the tag expansion example: "

. B<format:> The tag is listed first.  A blank line separates it from
the expanded return value.

. B<long lines:> When this document must break a line from an example
because it is too wide for the page, a trailing backslash indicates
the continuation. Note that such a trailing backslash is *not* part of
the actual tag syntax or expansion.
!endblock

ASP-like Perl call

!block example; lang='Perl'
    $Tag->area(  { href => URI_base,
                   arg  => CGI_GET_arguments, }  );
!endblock

or similarly,

!block example; lang='Perl'
    $Tag->area($href, $arg, $attribute_hash_reference);
!endblock


A3: Description

More detailed tag description

A4: first

Section describing the first parameter

A5: {{CMD[id="dummy_special_value"]special_value}}

Description of treatment of the special argument.  For example, giving
the {{CMD[jump="#page"]page}} tag an B<href> of 'scan' causes it to
link to a search specification rather than a page.

A4: {{CMD[id="dummy_more"]more}}

C<more> is a named attribute that applies to this tag.

A4: {{CMD[id="dummy_still_more"]still-more}}

C<still-more> is a named attribute that applies to this tag only when
the C<more> attribute has been given.  It would be an error to use the
C<still-more> attribute without specifying a value for C<more>

A4: {{CMD[id="dummy_other"]other}}

'other' is another named attribute that applies to this tag.


A1: Template Parsing Order

!include "icparseorder.inc"
